<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<link rel="icon" href="data:,">
<title>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© â€” 2043</title>
<link rel="stylesheet" href="assets/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="assets/tickers.js"></script>
<script src="assets/data.js"></script>
<script src="assets/auth.js"></script>
<script src="assets/data-sync.js"></script>
<style>
.welcome-card {
  background:linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
  border-radius:var(--radius); padding:32px; color:#fff;
  margin-bottom:28px; box-shadow:0 4px 20px rgba(99,102,241,.3);
}
.welcome-card h2 { margin:0 0 8px; font-size:26px; }
.welcome-card p { margin:0; opacity:.9; font-size:14px; }
.quick-actions {
  display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:16px; margin-bottom:28px;
}
.quick-btn {
  background:var(--card); border:1px solid var(--border);
  border-radius:var(--radius); padding:20px; text-align:center;
  cursor:pointer; transition:all .2s; text-decoration:none; color:var(--text);
}
.quick-btn:hover { border-color:var(--accent); transform:translateY(-4px); box-shadow:0 6px 20px rgba(0,0,0,.15); }
.quick-btn .icon { font-size:32px; margin-bottom:8px; }
.quick-btn .label { font-size:14px; font-weight:600; }
.chart-wrap { position:relative; width:100%; height:280px; }
.chart-wrap canvas { width:100% !important; height:100% !important; }
</style>
</head>
<body>
<script>initPage('dashboard');</script>

<div class="main">
  
  <div class="welcome-card">
    <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ 2043 ğŸ’</h2>
    <p>Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ ÙˆØ¶Ø¹Ùƒ Ø§Ù„Ù…Ø§Ù„ÙŠ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</p>
  </div>

  <div class="kpi-grid cols-4" id="mainKPIs"></div>

  <div class="quick-actions">
    <a href="transactions.html" class="quick-btn">
      <div class="icon">ğŸ”„</div>
      <div class="label">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ©</div>
    </a>
    <a href="dividends.html" class="quick-btn">
      <div class="icon">ğŸ’°</div>
      <div class="label">ØªØ³Ø¬ÙŠÙ„ ØªÙˆØ²ÙŠØ¹</div>
    </a>
    <a href="portfolio.html" class="quick-btn">
      <div class="icon">ğŸ’¹</div>
      <div class="label">Ø§Ù„Ù…Ø­ÙØ¸Ø©</div>
    </a>
    <a href="networth.html" class="quick-btn">
      <div class="icon">ğŸ“Š</div>
      <div class="label">ØµØ§ÙÙŠ Ø§Ù„Ø«Ø±ÙˆØ©</div>
    </a>
  </div>

  <div class="chart-grid cols-2">
    <div class="chart-card">
      <div class="chart-title">ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­ÙØ¸Ø©</div>
      <div class="chart-wrap"><canvas id="portfolioChart"></canvas></div>
    </div>
    <div class="chart-card">
      <div class="chart-title">ğŸ’° Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</div>
      <div class="chart-wrap"><canvas id="dividendsChart"></canvas></div>
    </div>
  </div>

  <div class="chart-card">
    <div class="chart-title">ğŸ† Ø£ÙØ¶Ù„ 5 Ø£Ø³Ù‡Ù… Ø£Ø¯Ø§Ø¡Ù‹</div>
    <div class="table-wrap" id="top5Table"></div>
  </div>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  State & Data
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let chartPortfolio = null;
let chartDividends = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Init
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  renderKPIs();
  renderPortfolioChart();
  renderDividendsChart();
  renderTop5();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  KPIs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderKPIs() {
  const nw = calcNetWorth();
  const portfolio = APP.portfolio;
  const dividends = APP.dividends;
  
  const totalDividends = dividends.reduce((s, d) => s + d.amount, 0);
  const stocksCount = portfolio.length;

  const kpis = [
    { label:'ØµØ§ÙÙŠ Ø§Ù„Ø«Ø±ÙˆØ©',    value:H.fmt(nw.total, 0) + ' Ø±.Ø³',       icon:'ğŸ’' },
    { label:'Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©',   value:H.fmt(nw.stocksValue, 0) + ' Ø±.Ø³', icon:'ğŸ’¹' },
    { label:'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª', value:H.fmt(totalDividends, 0) + ' Ø±.Ø³', icon:'ğŸ’°' },
    { label:'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù…',      value:stocksCount.toString(),             icon:'ğŸ“Š' }
  ];

  document.getElementById('mainKPIs').innerHTML = kpis.map(k => `
    <div class="kpi-card">
      <div class="kpi-icon">${k.icon}</div>
      <div class="kpi-value">${k.value}</div>
      <div class="kpi-label">${k.label}</div>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Portfolio Chart
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPortfolioChart() {
  const portfolio = APP.portfolio;
  if (!portfolio.length) {
    document.querySelector('#portfolioChart').parentElement.innerHTML = 
      '<p style="text-align:center;color:var(--text3);padding:60px 20px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù‡Ù… ÙÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©</p>';
    return;
  }

  const data = portfolio.map(p => ({
    ticker: p.ticker,
    value: p.qty * p.current_price
  })).sort((a,b) => b.value - a.value).slice(0, 10);

  const ctx = document.getElementById('portfolioChart').getContext('2d');
  
  if (chartPortfolio) chartPortfolio.destroy();
  
  chartPortfolio = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: data.map(d => H.tickerName(d.ticker)),
      datasets: [{
        data: data.map(d => d.value),
        backgroundColor: [
          '#6366f1','#8b5cf6','#ec4899','#f59e0b',
          '#10b981','#06b6d4','#ef4444','#84cc16',
          '#a855f7','#14b8a6'
        ],
        borderWidth: 2,
        borderColor: 'var(--card)'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'right', labels: { color: 'var(--text)', font: { size: 11 } } },
        tooltip: {
          callbacks: {
            label: (ctx) => `${ctx.label}: ${H.fmt(ctx.parsed, 0)} Ø±.Ø³`
          }
        }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Dividends Chart
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDividendsChart() {
  const dividends = APP.dividends;
  if (!dividends.length) {
    document.querySelector('#dividendsChart').parentElement.innerHTML = 
      '<p style="text-align:center;color:var(--text3);padding:60px 20px">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØ²ÙŠØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø©</p>';
    return;
  }

  const byMonth = {};
  dividends.forEach(d => {
    const month = d.date.substring(0, 7);
    byMonth[month] = (byMonth[month] || 0) + d.amount;
  });

  const sorted = Object.keys(byMonth).sort();
  const last12 = sorted.slice(-12);

  const ctx = document.getElementById('dividendsChart').getContext('2d');
  
  if (chartDividends) chartDividends.destroy();
  
  chartDividends = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: last12.map(m => {
        const [y, mo] = m.split('-');
        return `${mo}/${y.slice(2)}`;
      }),
      datasets: [{
        label: 'Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª (Ø±.Ø³)',
        data: last12.map(m => byMonth[m]),
        backgroundColor: '#6366f1',
        borderRadius: 6
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: (ctx) => `${H.fmt(ctx.parsed.y, 0)} Ø±.Ø³`
          }
        }
      },
      scales: {
        y: { 
          beginAtZero: true,
          ticks: { color: 'var(--text3)' },
          grid: { color: 'var(--border)' }
        },
        x: { 
          ticks: { color: 'var(--text3)' },
          grid: { display: false }
        }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Top 5 Performers
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTop5() {
  const portfolio = APP.portfolio;
  if (!portfolio.length) {
    document.getElementById('top5Table').innerHTML = 
      '<p style="text-align:center;color:var(--text3);padding:40px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
    return;
  }

  const withPnL = portfolio.map(p => {
    const pnl = (p.current_price - p.avg_cost) * p.qty;
    const pnlPct = p.avg_cost > 0 ? (p.current_price - p.avg_cost) / p.avg_cost * 100 : 0;
    return { ...p, pnl, pnlPct };
  }).sort((a,b) => b.pnlPct - a.pnlPct).slice(0, 5);

  const html = `
    <table>
      <thead>
        <tr><th>Ø§Ù„Ø³Ù‡Ù…</th><th>Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©</th><th>Ø§Ù„Ù†Ø³Ø¨Ø©</th></tr>
      </thead>
      <tbody>
        ${withPnL.map(p => `
          <tr>
            <td><strong>${H.tickerName(p.ticker)}</strong></td>
            <td style="${H.colorStyle(p.pnl)}">${H.fmt(p.pnl, 2)} Ø±.Ø³</td>
            <td style="${H.colorStyle(p.pnlPct)}">${H.pct(p.pnlPct)}</td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  document.getElementById('top5Table').innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Sync Listeners
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
dataSync.onDataChanged('portfolio', init);
dataSync.onDataChanged('transactions', init);
dataSync.onDataChanged('dividends', init);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Run
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
init();
</script>

</body>
</html>
