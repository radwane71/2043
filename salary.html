<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<link rel="icon" href="data:,">
<title>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø±Ø§ØªØ¨ â€” 2043</title>
<link rel="stylesheet" href="assets/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="assets/tickers.js"></script>
<script src="assets/data.js"></script>
<script src="assets/auth.js"></script>
<script src="assets/data-sync.js"></script>
<script src="assets/ticker-helper.js"></script>
<style>
.salary-table-wrap {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: auto;
  margin-bottom: 24px;
}
.salary-table-wrap table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
  min-width: 1200px;
}
.salary-table-wrap thead th {
  background: var(--bg2);
  color: var(--text3);
  font-weight: 700;
  font-size: 10px;
  padding: 10px 10px;
  text-align: center;
  border-bottom: 1px solid var(--border);
  white-space: nowrap;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  position: sticky;
  top: 0;
  z-index: 2;
}
.salary-table-wrap tbody td {
  padding: 9px 10px;
  border-bottom: 1px solid var(--border);
  text-align: center;
  white-space: nowrap;
}
.salary-table-wrap tbody tr:last-child td { border-bottom: none; }
.salary-table-wrap tbody tr:hover td { background: rgba(79,142,247,0.03); }

.th-group {
  background: var(--card2) !important;
  color: var(--accent) !important;
  font-size: 10px !important;
  padding: 6px 10px !important;
  border-bottom: 1px solid var(--border2) !important;
}

.col-year    { background: rgba(99,102,241,0.06); font-weight: 700; color: var(--accent); }
.col-month   { background: rgba(99,102,241,0.04); color: var(--text2); }
.col-income  { background: rgba(34,197,94,0.04); }
.col-deduct  { background: rgba(239,68,68,0.04); }
.col-split   { background: rgba(245,158,11,0.04); }
.col-net     { background: rgba(79,142,247,0.06); font-weight: 700; }
.col-invest  { background: rgba(34,197,94,0.06); font-weight: 700; color: var(--green); }

.editable-cell {
  cursor: pointer;
  border-bottom: 1px dashed var(--border2);
  display: inline-block;
  min-width: 50px;
  transition: border-color 0.2s;
}
.editable-cell:hover { border-color: var(--accent); color: var(--accent); }

.cell-input {
  width: 80px;
  padding: 3px 5px;
  background: var(--bg2);
  border: 1px solid var(--accent);
  border-radius: 4px;
  color: var(--text);
  font-size: 11px;
  text-align: center;
  outline: none;
  font-family: inherit;
}

.filter-tabs {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}
.filter-tab {
  padding: 5px 12px;
  border-radius: 20px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text3);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.18s;
  font-family: inherit;
}
.filter-tab:hover  { border-color: var(--accent); color: var(--accent); }
.filter-tab.active { background: var(--accent); border-color: var(--accent); color: #fff; }
</style>
</head>
<body>
<script>initPage('salary');</script>

<div class="main">

  <div class="page-header">
    <div class="page-header-left">
      <h1>ğŸ’³ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø±Ø§ØªØ¨</h1>
      <p>ØªØªØ¨Ø¹ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø±Ø§ØªØ¨ Ù…Ù†Ø° 2019</p>
    </div>
    <div class="page-header-right">
      <button class="btn btn-ghost btn-sm" onclick="exportCSV()">ğŸ“¥ ØªØµØ¯ÙŠØ± CSV</button>
      <button class="btn btn-primary btn-sm" onclick="saveAll()">ğŸ’¾ Ø­ÙØ¸</button>
    </div>
  </div>

  <div class="kpi-grid cols-4" id="salaryKPIs"></div>

  <div class="form-card">
    <h3>â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø´Ù‡Ø±ÙŠ</h3>
    <div class="form-row">
      <div class="form-group"><label>Ø§Ù„Ø³Ù†Ø©</label><input id="s-year" type="number" placeholder="2026" min="2015" max="2060"></div>
      <div class="form-group">
        <label>Ø§Ù„Ø´Ù‡Ø±</label>
        <select id="s-month">
          <option value="1">ÙŠÙ†Ø§ÙŠØ±</option><option value="2">ÙØ¨Ø±Ø§ÙŠØ±</option>
          <option value="3">Ù…Ø§Ø±Ø³</option><option value="4">Ø£Ø¨Ø±ÙŠÙ„</option>
          <option value="5">Ù…Ø§ÙŠÙˆ</option><option value="6">ÙŠÙˆÙ†ÙŠÙˆ</option>
          <option value="7">ÙŠÙˆÙ„ÙŠÙˆ</option><option value="8">Ø£ØºØ³Ø·Ø³</option>
          <option value="9">Ø³Ø¨ØªÙ…Ø¨Ø±</option><option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
          <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option><option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
        </select>
      </div>
      <div class="form-group"><label>Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label><input id="s-basic" type="number" step="0.01" placeholder="0"></div>
      <div class="form-group"><label>Ø¨Ø¯Ù„ Ø§Ù„Ø³ÙƒÙ†</label><input id="s-housing" type="number" step="0.01" placeholder="0"></div>
      <div class="form-group"><label>Ø¨Ø¯Ù„ Ø§Ù„Ù†Ù‚Ù„</label><input id="s-transport" type="number" step="0.01" placeholder="0"></div>
      <div class="form-group"><label>Ø£ÙˆÙØ± ØªØ§ÙŠÙ…</label><input id="s-overtime" type="number" step="0.01" placeholder="0" oninput="calcSalaryPreview()"></div>
      <div class="form-group"><label>Ø¨Ø¯Ù„Ø§Øª Ø£Ø®Ø±Ù‰</label><input id="s-other" type="number" step="0.01" placeholder="0" oninput="calcSalaryPreview()"></div>
      <div class="form-group"><label>GOSI</label><input id="s-gosi" type="number" step="0.01" placeholder="0" oninput="calcSalaryPreview()"></div>
      <div class="form-group"><label>Ø®ØµÙ… Ø³Ø§Ù†Ø¯</label><input id="s-saned" type="number" step="0.01" placeholder="0" oninput="calcSalaryPreview()"></div>
    </div>
    <div id="salaryPreview" style="display:none;margin-bottom:14px;padding:12px 16px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;font-size:13px;display:flex;gap:24px;flex-wrap:wrap">
      <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <strong id="prev-gross" class="accent">â€”</strong></span>
      <span>Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª: <strong id="prev-deduct" style="color:var(--red)">â€”</strong></span>
      <span>Ø§Ù„ØµØ§ÙÙŠ: <strong id="prev-net" class="pos">â€”</strong></span>
    </div>
    <div style="margin-bottom:14px">
      <div style="font-size:12px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.4px;margin-bottom:10px">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø±Ø§ØªØ¨</div>
      <div class="form-row" id="splitFieldsRow"></div>
    </div>
    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <button class="btn btn-primary" onclick="addRecord()">â• Ø¥Ø¶Ø§ÙØ©</button>
      <span id="remainingPreview" style="font-size:13px;color:var(--text3)"></span>
    </div>
  </div>

  <div class="toolbar">
    <div class="filter-tabs" id="yearTabs"></div>
    <button class="btn btn-ghost btn-sm" onclick="showManageColumns()">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©</button>
  </div>

  <div class="salary-table-wrap">
    <table id="salaryTable">
      <thead id="salaryHead"></thead>
      <tbody id="salaryBody"></tbody>
    </table>
  </div>

</div>

<!-- Manage Columns Modal -->
<div id="colModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:500;align-items:center;justify-content:center">
  <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:28px;width:90%;max-width:560px;max-height:80vh;overflow-y:auto">
    <h3 style="margin-bottom:16px;font-size:15px">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØªÙˆØ²ÙŠØ¹</h3>
    <div class="info-box blue" style="margin-bottom:16px;font-size:12px">Ø£Ø¶Ù Ø£Ùˆ Ø¹Ø¯Ù‘Ù„ Ø£Ùˆ Ø§Ø­Ø°Ù Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØªÙˆØ²ÙŠØ¹. Ø§Ù„ØªØ±ØªÙŠØ¨ ÙŠØ¹ÙƒØ³ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„.</div>
    <div id="colList" style="margin-bottom:16px"></div>
    <div style="display:flex;gap:10px;margin-bottom:16px">
      <input id="newColName" class="field-inline" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯" style="flex:1">
      <button class="btn btn-primary btn-sm" onclick="addColumn()">+ Ø¥Ø¶Ø§ÙØ©</button>
    </div>
    <div style="display:flex;gap:10px;justify-content:flex-end">
      <button class="btn btn-ghost" onclick="document.getElementById('colModal').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
      <button class="btn btn-primary" onclick="saveColumns()">ğŸ’¾ Ø­ÙØ¸</button>
    </div>
  </div>
</div>

<script>
const DEFAULT_COLS = [
  { id:'col_house_exp', label:'Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¨ÙŠØª' },
  { id:'col_wife',      label:'Ù…Ø¹ÙˆÙ†Ø© Ø§Ù„Ø²ÙˆØ¬Ø©' },
  { id:'col_fun',       label:'Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±ÙÙŠÙ‡' },
  { id:'col_emergency', label:'Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ø·Ø§Ø±Ø¦' },
  { id:'col_loan',      label:'ØªÙ…ÙˆÙŠÙ„' },
  { id:'col_rc_house',  label:'Ø¨ÙŠØª Ø§Ù„Ù‡ÙŠØ¦Ø©' },
];

const MONTHS = ['','ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ',
  'ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù…Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ 2019â€“2025
//  Ø¹Ù…ÙˆØ¯ sal_net: Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù…Ø¯Ø®Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø³Ù†ÙˆØ§Øª Ù…Ù† 2025 ÙˆØ£Ø®ÙŠØ±Ø§Ù‹
//  (Ø£Ø¨ØªØ¹ØªÙ‡ Ù…Ø®ØªÙ„Ù Ø¹Ù† Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø³Ù†ÙˆØ§Øª)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SEED_RECORDS = [
  // 2019
  {year:2019,month:1, basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:1289.76, after_split:11812.61},
  {year:2019,month:2, basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:9083.69, after_split:4018.68},
  {year:2019,month:3, basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:5002.56, after_split:8099.81},
  {year:2019,month:4, basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:5589.9,  after_split:7512.47},
  {year:2019,month:5, basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:4362.43, after_split:8739.94},
  {year:2019,month:6, basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:5729.64, after_split:7372.73},
  {year:2019,month:7, basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:6307.04, after_split:6795.33},
  {year:2019,month:8, basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:9029.97, after_split:4072.4},
  {year:2019,month:9, basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:4546.45, after_split:8555.92},
  {year:2019,month:10,basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:25164.32,after_split:-12061.95},
  {year:2019,month:11,basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:5741.56, after_split:7360.81},
  {year:2019,month:12,basic:10364.08,housing:2083,transport:900,overtime:0,other:0,gosi:1244.708,saned:0,gross:14347.08,net:13102.37,col_house_exp:8075.21, after_split:5027.16},
  // 2020
  {year:2020,month:1, basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:3946.3,  after_split:8622.83},
  {year:2020,month:2, basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:5619.65, after_split:6949.48},
  {year:2020,month:3, basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:14030.82,after_split:-1461.69},
  {year:2020,month:4, basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:16792.87,after_split:-4223.74},
  {year:2020,month:5, basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:8915.28, after_split:3653.85},
  {year:2020,month:6, basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:9888.63, after_split:2680.5},
  {year:2020,month:7, basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:11490.59,after_split:1078.54},
  {year:2020,month:8, basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:10368.75,after_split:2200.38},
  {year:2020,month:9, basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:18910.59,after_split:-6341.46},
  {year:2020,month:10,basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:15100.84,after_split:-2531.71},
  {year:2020,month:11,basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:11827.4, after_split:741.73},
  {year:2020,month:12,basic:10882.7,housing:2083,transport:900,overtime:0,other:0,gosi:1296.57,saned:0,gross:13865.7,net:12569.13,col_house_exp:10004.15,after_split:2564.98},
  // 2021
  {year:2021,month:1, basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:10879.83,after_split:2179.41},
  {year:2021,month:2, basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:14367.5, after_split:-1308.26},
  {year:2021,month:3, basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:14499.51,after_split:-1440.27},
  {year:2021,month:4, basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:9731.79, after_split:3327.45},
  {year:2021,month:5, basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:10903.41,after_split:2155.83},
  {year:2021,month:6, basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:21142.5, after_split:-8083.26},
  {year:2021,month:7, basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:14386.79,after_split:-1327.55},
  {year:2021,month:8, basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:8145.6,  after_split:4913.64},
  {year:2021,month:9, basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:27160.26,after_split:-14101.02},
  {year:2021,month:10,basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:20982.99,after_split:-7923.75},
  {year:2021,month:11,basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:11411.74,after_split:1647.5},
  {year:2021,month:12,basic:11427.27,housing:2083,transport:900,overtime:0,other:0,gosi:1351.027,saned:0,gross:14410.27,net:13059.24,col_house_exp:10803.22,after_split:2256.02},
  // 2022
  {year:2022,month:1, basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:9638.59, after_split:5563.84},
  {year:2022,month:2, basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:14461.85,after_split:740.58},
  {year:2022,month:3, basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:10737,   after_split:4465.43},
  {year:2022,month:4, basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:10336,   after_split:4866.43},
  {year:2022,month:5, basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:7549,    after_split:7653.43},
  {year:2022,month:6, basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:7365,    after_split:7837.43},
  {year:2022,month:7, basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:20928,   after_split:-5725.57},
  {year:2022,month:8, basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:325945,  after_split:-310742.57},
  {year:2022,month:9, basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:34526,   after_split:-19323.57},
  {year:2022,month:10,basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:16929,   after_split:-1726.57},
  {year:2022,month:11,basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:15583,   after_split:-380.57},
  {year:2022,month:12,basic:13160,housing:2193.333,transport:1200,overtime:0,other:0,gosi:1350.901,saned:0,gross:16553.33,net:15202.43,col_house_exp:34125.71,after_split:-18923.28},
  // 2023
  {year:2023,month:1, basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:16499.11,after_split:-312.05},
  {year:2023,month:2, basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:17132.48,after_split:-945.42},
  {year:2023,month:3, basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:13692.79,after_split:2494.27},
  {year:2023,month:4, basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:13276.44,after_split:2910.62},
  {year:2023,month:5, basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:12607.43,after_split:3579.63},
  {year:2023,month:6, basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:21019.16,after_split:-4832.1},
  {year:2023,month:7, basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:11659.71,after_split:4527.35},
  {year:2023,month:8, basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:9552,    after_split:6635.06},
  {year:2023,month:9, basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:78575.99,after_split:-62388.93},
  {year:2023,month:10,basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:21019,   after_split:-4831.94},
  {year:2023,month:11,basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:11660,   after_split:4527.06},
  {year:2023,month:12,basic:14233.86,housing:2372.309,transport:1200,overtime:0,other:0,gosi:1619.101,saned:0,gross:17806.17,net:16187.06,col_house_exp:9552,    after_split:6635.06},
  // 2024
  {year:2024,month:1, basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:78576,  after_split:-61789.45},
  {year:2024,month:2, basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:5012,   after_split:11774.55},
  {year:2024,month:3, basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:13883,  after_split:2903.55},
  {year:2024,month:4, basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:23840,  after_split:-7053.45},
  {year:2024,month:5, basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:17233,  after_split:-446.45},
  {year:2024,month:6, basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:12453,  after_split:4333.55},
  {year:2024,month:7, basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:19236,  after_split:-2449.45},
  {year:2024,month:8, basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:15819,  after_split:967.55},
  {year:2024,month:9, basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:13499,  after_split:3287.55},
  {year:2024,month:10,basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:9061,   after_split:7725.55},
  {year:2024,month:11,basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:13424,  after_split:3362.55},
  {year:2024,month:12,basic:14803.21,housing:2467.202,transport:1200,overtime:0,other:0,gosi:1683.865,saned:0,gross:18470.41,net:16786.55,col_house_exp:12222,  after_split:4564.55},
  // 2025 â€” ØµØ§ÙÙŠ Ø§Ù„Ø±Ø§ØªØ¨ Ù…Ø®ØªÙ„Ù (salary Ù…ÙƒØ§ÙØ£Ø© Ù…Ù„Ø­Ù‚ÙŠØ©)
  {year:2025,month:1, basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:5080,  col_house_exp:11844,after_split:-6764},
  {year:2025,month:2, basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:29839,col_house_exp:13693,after_split:16146},
  {year:2025,month:3, basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:20363,col_house_exp:12291,after_split:8072},
  {year:2025,month:4, basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:20024,col_house_exp:35138,after_split:-15114},
  {year:2025,month:5, basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:21139,col_house_exp:29785,after_split:-8646},
  {year:2025,month:6, basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:19392,col_house_exp:28778,after_split:-9386},
  {year:2025,month:7, basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:19263,col_house_exp:17520,after_split:1743},
  {year:2025,month:8, basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:19346,col_house_exp:16670,after_split:2676},
  {year:2025,month:9, basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:19361,col_house_exp:10418,after_split:8943},
  {year:2025,month:10,basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:49121,col_house_exp:17687,after_split:31434},
  {year:2025,month:11,basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:23414,col_house_exp:89443,after_split:-66029},
  {year:2025,month:12,basic:15394,housing:2565.667,transport:1200,overtime:0,other:0,gosi:1751.068,saned:0,gross:19159.67,net:19818,col_house_exp:22280,after_split:-2462},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  State
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù„Ùˆ ÙƒØ§Ù† localStorage ÙØ§Ø±Øº Ù†Ø­Ù…Ù‘Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø©
const _saved = Store.load('salary_v1', null);
let records   = (_saved && _saved.length > 0) ? _saved : [...SEED_RECORDS];
let splitCols  = Store.load('salary_cols_v1', DEFAULT_COLS);
let activeYear = 'all';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  KPIs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderKPIs() {
  const totalGross  = records.reduce((s,r) => s + (r.gross||0), 0);
  const totalNet    = records.reduce((s,r) => s + (r.net||0),   0);
  const totalDeduct = records.reduce((s,r) => s + (r.gosi||0) + (r.saned||0), 0);
  const totalInvest = records.reduce((s,r) => s + (r.col_invest||0), 0);
  const totalHouseExp = records.reduce((s,r) => s + (r.col_house_exp||0), 0);

  document.getElementById('salaryKPIs').innerHTML = `
    <div class="kpi-card">
      <div class="kpi-icon">ğŸ’µ</div>
      <div class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„</div>
      <div class="kpi-value accent">${H.fmt(totalGross)}</div>
      <div class="kpi-sub">SAR â€¢ ${records.length} Ø´Ù‡Ø±</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">âœ…</div>
      <div class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµØ§ÙÙŠ</div>
      <div class="kpi-value pos">${H.fmt(totalNet)}</div>
      <div class="kpi-sub">Ø¨Ø¹Ø¯ GOSI ÙˆØ³Ø§Ù†Ø¯</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">ğŸ </div>
      <div class="kpi-label">Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¨ÙŠØª</div>
      <div class="kpi-value neg">${H.fmt(totalHouseExp)}</div>
      <div class="kpi-sub">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…ØµØ±ÙˆÙ</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">ğŸ“ˆ</div>
      <div class="kpi-label">Ù…Ø­ÙˆÙ„ Ù„Ù„Ù…Ø­ÙØ¸Ø©</div>
      <div class="kpi-value" style="color:var(--green)">${H.fmt(totalInvest)}</div>
      <div class="kpi-sub">Ù…Ø±Ø¬Ø¹ÙŠ ÙÙ‚Ø·</div>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Calc Preview
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcSalaryPreview() {
  const basic     = parseFloat(document.getElementById('s-basic').value)     || 0;
  const housing   = parseFloat(document.getElementById('s-housing').value)   || 0;
  const transport = parseFloat(document.getElementById('s-transport').value) || 0;
  const overtime  = parseFloat(document.getElementById('s-overtime').value)  || 0;
  const other     = parseFloat(document.getElementById('s-other').value)     || 0;
  const gosi      = parseFloat(document.getElementById('s-gosi').value)      || 0;
  const saned     = parseFloat(document.getElementById('s-saned').value)     || 0;
  const gross = basic + housing + transport + overtime + other;
  const net   = gross - gosi - saned;
  const prev  = document.getElementById('salaryPreview');
  prev.style.display = 'flex';
  document.getElementById('prev-gross').textContent  = H.fmt(gross) + ' SAR';
  document.getElementById('prev-deduct').textContent = H.fmt(gosi + saned) + ' SAR';
  document.getElementById('prev-net').textContent    = H.fmt(net)   + ' SAR';
  calcRemaining();
}

function calcRemaining() {
  const netTxt = document.getElementById('prev-net')?.textContent || '0';
  const net    = parseFloat(netTxt.replace(/[^\d.-]/g,'')) || 0;
  let spent = 0;
  splitCols.forEach(c => { const el = document.getElementById('sf-'+c.id); if(el) spent += parseFloat(el.value)||0; });
  const inv = document.getElementById('sf-col_invest');
  if (inv) spent += parseFloat(inv.value) || 0;
  const rem = net - spent;
  const el  = document.getElementById('remainingPreview');
  if (el) { el.textContent = `Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆØ²ÙŠØ¹: ${H.fmt(rem)} SAR`; el.style.color = rem>=0?'var(--green)':'var(--red)'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Render Split Fields
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSplitFields() {
  const all = [...splitCols, { id:'col_invest', label:'Ù…Ø­ÙØ¸Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ ğŸ“ˆ' }];
  document.getElementById('splitFieldsRow').innerHTML = all.map(c => `
    <div class="form-group">
      <label>${c.label}</label>
      <input id="sf-${c.id}" type="number" step="0.01" placeholder="0" oninput="calcRemaining()">
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Add Record
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addRecord() {
  const year      = parseInt(document.getElementById('s-year').value)      || 0;
  const month     = parseInt(document.getElementById('s-month').value)     || 0;
  const basic     = parseFloat(document.getElementById('s-basic').value)     || 0;
  const housing   = parseFloat(document.getElementById('s-housing').value)   || 0;
  const transport = parseFloat(document.getElementById('s-transport').value) || 0;
  const overtime  = parseFloat(document.getElementById('s-overtime').value)  || 0;
  const other     = parseFloat(document.getElementById('s-other').value)     || 0;
  const gosi      = parseFloat(document.getElementById('s-gosi').value)      || 0;
  const saned     = parseFloat(document.getElementById('s-saned').value)     || 0;
  if (!year || !month) return toast('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†Ø© ÙˆØ§Ù„Ø´Ù‡Ø±','error');
  if (records.find(r => r.year===year && r.month===month))
    return toast(`${MONTHS[month]} ${year} Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„`,'error');
  const gross = basic+housing+transport+overtime+other;
  const net   = gross-gosi-saned;
  const rec   = {year,month,basic,housing,transport,overtime,other,gosi,saned,gross,net};
  splitCols.forEach(c => { rec[c.id] = parseFloat(document.getElementById('sf-'+c.id)?.value)||0; });
  rec.col_invest = parseFloat(document.getElementById('sf-col_invest')?.value)||0;
  let spent = splitCols.reduce((s,c)=>s+(rec[c.id]||0),0) + (rec.col_invest||0);
  rec.after_split = parseFloat((net-spent).toFixed(2));
  records.push(rec);
  records.sort((a,b)=>a.year*12+a.month-(b.year*12+b.month));
  ['s-basic','s-housing','s-transport','s-overtime','s-other','s-gosi','s-saned'].forEach(id=>document.getElementById(id).value='');
  splitCols.forEach(c=>{const el=document.getElementById('sf-'+c.id);if(el)el.value='';});
  const inv=document.getElementById('sf-col_invest');if(inv)inv.value='';
  document.getElementById('salaryPreview').style.display='none';
  document.getElementById('remainingPreview').textContent='';
  renderAll();
  toast(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${MONTHS[month]} ${year}`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Year Tabs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderYearTabs() {
  const years = [...new Set(records.map(r=>r.year))].sort();
  document.getElementById('yearTabs').innerHTML =
    [{v:'all',l:'Ø§Ù„ÙƒÙ„'},...years.map(y=>({v:y,l:y}))]
    .map(t=>`<button class="filter-tab ${activeYear==t.v?'active':''}" onclick="setYear(${t.v==='all'?"'all'":t.v},this)">${t.l}</button>`)
    .join('');
}

function setYear(y,btn) {
  activeYear=y;
  document.querySelectorAll('.filter-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderTable();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Render Table
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTable() {
  const filtered = activeYear==='all' ? records : records.filter(r=>r.year==activeYear);
  const allCols  = [...splitCols, {id:'col_invest',label:'Ù…Ø­ÙØ¸Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯'}];
  const colSpan  = 14 + allCols.length;

  document.getElementById('salaryHead').innerHTML = `
    <tr>
      <th class="th-group" colspan="2">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
      <th class="th-group" colspan="5">ğŸ’µ Ø§Ù„Ø¯Ø®Ù„</th>
      <th class="th-group" colspan="2">ğŸ“¤ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª</th>
      <th class="th-group" colspan="2">âœ… Ø§Ù„ØµØ§ÙÙŠ</th>
      <th class="th-group" colspan="${allCols.length}">ğŸ”€ Ø§Ù„ØªÙˆØ²ÙŠØ¹</th>
      <th class="th-group" colspan="2">ğŸ“Š Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
    </tr>
    <tr>
      <th>Ø§Ù„Ø³Ù†Ø©</th><th>Ø§Ù„Ø´Ù‡Ø±</th>
      <th>Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th><th>Ø§Ù„Ø³ÙƒÙ†</th><th>Ø§Ù„Ù†Ù‚Ù„</th><th>Ø£ÙˆÙØ± ØªØ§ÙŠÙ…</th><th>Ø¨Ø¯Ù„Ø§Øª Ø£Ø®Ø±Ù‰</th>
      <th>GOSI</th><th>Ø³Ø§Ù†Ø¯</th>
      <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø§Ù„ØµØ§ÙÙŠ</th>
      ${allCols.map(c=>`<th>${c.label}</th>`).join('')}
      <th>Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆØ²ÙŠØ¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th>
    </tr>`;

  if (!filtered.length) {
    document.getElementById('salaryBody').innerHTML =
      `<tr><td colspan="${colSpan}"><div class="empty-state"><div class="empty-icon">ğŸ“‹</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</p></div></td></tr>`;
    return;
  }

  const totals = {};
  ['basic','housing','transport','overtime','other','gosi','saned','gross','net','after_split',...allCols.map(c=>c.id)]
    .forEach(f => { totals[f] = filtered.reduce((s,r)=>s+(r[f]||0),0); });

  document.getElementById('salaryBody').innerHTML =
    filtered.map(r => {
      const ri = records.indexOf(r);
      return `<tr>
        <td class="col-year">${r.year}</td>
        <td class="col-month">${MONTHS[r.month]}</td>
        <td class="col-income"><span class="editable-cell" onclick="editCell(this,${ri},'basic')">${H.fmt(r.basic||0,0)}</span></td>
        <td class="col-income"><span class="editable-cell" onclick="editCell(this,${ri},'housing')">${H.fmt(r.housing||0,0)}</span></td>
        <td class="col-income"><span class="editable-cell" onclick="editCell(this,${ri},'transport')">${H.fmt(r.transport||0,0)}</span></td>
        <td class="col-income"><span class="editable-cell" onclick="editCell(this,${ri},'overtime')">${H.fmt(r.overtime||0,0)}</span></td>
        <td class="col-income"><span class="editable-cell" onclick="editCell(this,${ri},'other')">${H.fmt(r.other||0,0)}</span></td>
        <td class="col-deduct" style="color:var(--red)"><span class="editable-cell" onclick="editCell(this,${ri},'gosi')">${H.fmt(r.gosi||0,0)}</span></td>
        <td class="col-deduct" style="color:var(--red)"><span class="editable-cell" onclick="editCell(this,${ri},'saned')">${H.fmt(r.saned||0,0)}</span></td>
        <td class="col-net" style="color:var(--accent)">${H.fmt(r.gross||0,0)}</td>
        <td class="col-net" style="color:var(--green)">${H.fmt(r.net||0,0)}</td>
        ${allCols.map(c=>`<td class="col-split"><span class="editable-cell" onclick="editCell(this,${ri},'${c.id}')">${H.fmt(r[c.id]||0,0)}</span></td>`).join('')}
        <td class="col-net" style="color:${(r.after_split||0)>=0?'var(--green)':'var(--red)'}">${H.fmt(r.after_split||0,0)}</td>
        <td><button class="btn btn-danger btn-sm" onclick="deleteRecord(${ri})">ğŸ—‘</button></td>
      </tr>`;
    }).join('') +
    `<tr style="background:var(--bg2);font-weight:700;border-top:2px solid var(--border2)">
      <td colspan="2" style="color:var(--text3);font-size:11px;text-align:center">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
      <td class="col-income">${H.fmt(totals.basic,0)}</td>
      <td class="col-income">${H.fmt(totals.housing,0)}</td>
      <td class="col-income">${H.fmt(totals.transport,0)}</td>
      <td class="col-income">${H.fmt(totals.overtime,0)}</td>
      <td class="col-income">${H.fmt(totals.other,0)}</td>
      <td class="col-deduct" style="color:var(--red)">${H.fmt(totals.gosi,0)}</td>
      <td class="col-deduct" style="color:var(--red)">${H.fmt(totals.saned,0)}</td>
      <td class="col-net" style="color:var(--accent)">${H.fmt(totals.gross,0)}</td>
      <td class="col-net" style="color:var(--green)">${H.fmt(totals.net,0)}</td>
      ${allCols.map(c=>`<td class="col-split">${H.fmt(totals[c.id]||0,0)}</td>`).join('')}
      <td class="col-net">${H.fmt(totals.after_split,0)}</td>
      <td></td>
    </tr>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Edit Cell
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function editCell(span,idx,field) {
  if (span.querySelector('input')) return;
  const input = document.createElement('input');
  input.className='cell-input'; input.type='number'; input.value=records[idx][field]||0; input.step='0.01';
  span.textContent=''; span.appendChild(input); input.focus(); input.select();
  function commit() {
    const val=parseFloat(input.value);
    if(!isNaN(val)) {
      records[idx][field]=parseFloat(val.toFixed(2));
      const r=records[idx];
      r.gross=(r.basic||0)+(r.housing||0)+(r.transport||0)+(r.overtime||0)+(r.other||0);
      r.net=r.gross-(r.gosi||0)-(r.saned||0);
      let spent=[...splitCols,{id:'col_invest'}].reduce((s,c)=>s+(r[c.id]||0),0);
      r.after_split=parseFloat((r.net-spent).toFixed(2));
    }
    renderTable(); renderKPIs();
  }
  input.addEventListener('blur',commit);
  input.addEventListener('keydown',e=>{ if(e.key==='Enter')input.blur(); if(e.key==='Escape')renderTable(); });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Delete
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function deleteRecord(idx) {
  const r=records[idx];
  if(!confirm(`Ø­Ø°Ù ${MONTHS[r.month]} ${r.year}ØŸ`)) return;
  records.splice(idx,1); renderAll(); toast('ğŸ—‘ ØªÙ… Ø§Ù„Ø­Ø°Ù','warn');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Columns Modal
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showManageColumns() { renderColList(); document.getElementById('colModal').style.display='flex'; }
function renderColList() {
  document.getElementById('colList').innerHTML = splitCols.map((c,i)=>`
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <input class="field-inline" style="flex:1" value="${c.label}" onchange="splitCols[${i}].label=this.value">
      <button class="btn btn-danger btn-sm" onclick="removeColumn(${i})">ğŸ—‘</button>
    </div>`).join('');
}
function addColumn() {
  const name=document.getElementById('newColName').value.trim();
  if(!name) return toast('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯','error');
  splitCols.push({id:'col_'+Date.now(),label:name});
  document.getElementById('newColName').value='';
  renderColList(); toast('âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©');
}
function removeColumn(i) {
  if(!confirm(`Ø­Ø°Ù "â€${splitCols[i].label}"ØŸ`)) return;
  splitCols.splice(i,1); renderColList();
}
function saveColumns() {
  Store.save('salary_cols_v1',splitCols);
  document.getElementById('colModal').style.display='none';
  renderSplitFields(); renderTable();
  toast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Export CSV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportCSV() {
  const all   = [...splitCols,{id:'col_invest',label:'Ù…Ø­ÙØ¸Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯'}];
  const heads = ['year','month','basic','housing','transport','overtime','other','gosi','saned','gross','net',...all.map(c=>c.id),'after_split'];
  const labels= ['Ø§Ù„Ø³Ù†Ø©','Ø§Ù„Ø´Ù‡Ø±','Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ','Ø§Ù„Ø³ÙƒÙ†','Ø§Ù„Ù†Ù‚Ù„','Ø£ÙˆÙØ± ØªØ§ÙŠÙ…','Ø¨Ø¯Ù„Ø§Øª Ø£Ø®Ø±Ù‰','GOSI','Ø³Ø§Ù†Ø¯','Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ','Ø§Ù„ØµØ§ÙÙŠ',...all.map(c=>c.label),'Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆØ²ÙŠØ¹'];
  const csv   = '\uFEFF' + [labels.join(','),...records.map(r=>heads.map(h=>r[h]??'').join(','))].join('\n');
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
  a.download=`salary_${new Date().toISOString().slice(0,10)}.csv`; a.click();
  toast('ğŸ“¥ ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Save + Render
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveAll() {
  Store.save('salary_v1',records); Store.save('salary_cols_v1',splitCols);
  toast('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸');
}
function renderAll() { renderKPIs(); renderYearTabs(); renderTable(); }

// Init
renderSplitFields();
renderAll();
</script>
</body>
</html>
