<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<link rel="icon" href="data:,">
<title>Ø³Ù„Ù… Ø§Ù„Ø±Ø§ØªØ¨ â€” 2043</title>
<link rel="stylesheet" href="assets/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="assets/data.js"></script>
<script src="assets/auth.js"></script>
<style>
.scale-table-wrap {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: auto;
  margin-bottom: 24px;
}
.scale-table-wrap table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
  min-width: 1100px;
}
.scale-table-wrap thead th {
  background: var(--bg2);
  color: var(--text3);
  font-weight: 700;
  padding: 10px;
  text-align: center;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  z-index: 2;
}
.scale-table-wrap tbody td {
  padding: 5px 10px;
  border-bottom: 1px solid var(--border);
  text-align: center;
  white-space: nowrap;
}
.row-past td   { opacity: 0.55; }
.row-current td { background: rgba(79,142,247,0.08) !important; font-weight: 700; }
.field-inline {
  background: rgba(255,255,255,0.05);
  border: 1px solid transparent;
  color: inherit;
  padding: 4px 6px;
  border-radius: 4px;
  text-align: center;
  font-family: inherit;
  font-size: 12px;
  transition: border-color 0.15s;
}
.field-inline:focus {
  border-color: var(--accent);
  background: var(--bg);
  outline: none;
}
.unsaved-badge {
  display: none;
  padding: 4px 10px;
  background: rgba(245,158,11,0.15);
  border: 1px solid rgba(245,158,11,0.4);
  border-radius: 6px;
  color: var(--yellow, #f59e0b);
  font-size: 12px;
  font-weight: 600;
}
.unsaved-badge.show { display: inline-block; }
</style>
</head>
<body>
<script>initPage('salary-scale');</script>

<div class="main">

  <div class="page-header">
    <div class="page-header-left">
      <h1>ğŸ“ˆ Ø³Ù„Ù… Ø§Ù„Ø±Ø§ØªØ¨</h1>
      <p>Ø£Ø®ØµØ§Ø¦ÙŠ Ø£ÙˆÙ„ Ù…Ø®ØªØ¨Ø±Ø§Øª â€” ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ù„Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</p>
    </div>
    <div class="page-header-right" style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
      <span class="unsaved-badge" id="unsavedBadge">â— ØªØ¹Ø¯ÙŠÙ„Ø§Øª ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©</span>
      <button class="btn btn-ghost" onclick="exportCSV()">ğŸ“„ ØªØµØ¯ÙŠØ± CSV</button>
      <button class="btn btn-ghost" onclick="exportJSON()">ğŸ“¦ ØªØµØ¯ÙŠØ± JSON</button>
      <button class="btn btn-danger btn-sm" onclick="resetScale()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
      <button class="btn btn-primary" onclick="saveScale()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
    </div>
  </div>

  <!-- KPIs -->
  <div class="kpi-grid cols-4" id="scaleKPIs" style="margin-bottom:24px"></div>

  <!-- Table -->
  <div class="scale-table-wrap">
    <table>
      <thead>
        <tr>
          <th>Ø§Ù„Ø³Ù†Ø© Ù‡Ù€</th>
          <th>Ø§Ù„Ø³Ù†Ø© Ù…</th>
          <th>Ø§Ù„Ø¹Ù…Ø±</th>
          <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
          <th>Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th>
          <th>Ø¨Ø¯Ù„ Ø§Ù„Ø³ÙƒÙ†</th>
          <th>Ø¨Ø¯Ù„ Ø§Ù„Ù†Ù‚Ù„</th>
          <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
          <th>GOSI (9.75%)</th>
          <th>Ø³Ø§Ù†Ø¯ (0.75%)</th>
          <th>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø§ØªØ¨</th>
          <th>ØªÙƒÙ„ÙØ© Ø§Ù„Ø³Ø§Ø¹Ø©</th>
          <th>Ø£ÙˆÙØ± ØªØ§ÙŠÙ… (1.5x)</th>
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
        </tr>
      </thead>
      <tbody id="scaleBody"></tbody>
    </table>
  </div>

</div>

<script>
const CY = new Date().getFullYear();
let CURRENT_SCALE = Store.load('salary_scale_v1', APP.salaryScale || []);
let _dirty = false;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø´ØªÙ‚Ø© Ù„ØµÙ ÙˆØ§Ø­Ø¯
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcRow(d) {
  d.gross    = (d.basic || 0) + (d.housing || 0) + (d.transport || 0);
  d.gosi     = ((d.basic || 0) + (d.housing || 0)) * 0.0975;
  d.saned    = ((d.basic || 0) + (d.housing || 0)) * 0.0075;
  d.net      = d.gross - d.gosi - d.saned;
  d.cost_hr  = d.basic / (22 * 8);   // ØªÙƒÙ„ÙØ© Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  d.ot_hr    = d.cost_hr * 1.5;      // Ø£ÙˆÙØ± ØªØ§ÙŠÙ…
  return d;
}
CURRENT_SCALE = CURRENT_SCALE.map(calcRow);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  Render
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTable() {
  const tbody = document.getElementById('scaleBody');
  tbody.innerHTML = CURRENT_SCALE.map((d, i) => {
    const past    = d.year < CY;
    const current = d.year === CY;
    const cls     = past ? 'row-past' : current ? 'row-current' : '';
    return `
      <tr class="${cls}">
        <td>${d.hijri || 'â€”'}</td>
        <td style="font-weight:${current?'800':'400'};color:${current?'var(--accent)':'inherit'}">${d.year}</td>
        <td>${d.age  || 'â€”'}</td>
        <td>${d.exp  || 'â€”'}</td>

        <td><input type="number" class="field-inline" style="width:82px;color:var(--accent)"
              value="${d.basic}" data-i="${i}" data-f="basic"
              onchange="updateField(${i},'basic',this.value)"></td>

        <td><input type="number" class="field-inline" style="width:72px"
              value="${d.housing}" data-i="${i}" data-f="housing"
              onchange="updateField(${i},'housing',this.value)"></td>

        <td><input type="number" class="field-inline" style="width:64px"
              value="${d.transport}" data-i="${i}" data-f="transport"
              onchange="updateField(${i},'transport',this.value)"></td>

        <td id="gross-${i}"  style="font-weight:700">${H.fmt(d.gross)}</td>
        <td id="gosi-${i}"   style="color:var(--red)">${H.fmt(d.gosi)}</td>
        <td id="saned-${i}"  style="color:var(--red)">${H.fmt(d.saned)}</td>
        <td id="net-${i}"    style="color:var(--green);font-weight:700">${H.fmt(d.net)}</td>
        <td id="costhr-${i}" style="color:var(--text2)">${H.fmt(d.cost_hr, 2)}</td>
        <td id="othr-${i}"   style="color:var(--yellow,#f59e0b)">${H.fmt(d.ot_hr, 2)}</td>
        <td style="font-size:11px">${past ? 'âª Ù…Ø§Ø¶ÙŠ' : current ? 'ğŸ”µ Ø§Ù„Ø¢Ù†' : 'â© Ù…Ø³ØªÙ‚Ø¨Ù„'}</td>
      </tr>`;
  }).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  ØªØ­Ø¯ÙŠØ« Ø®Ù„ÙŠØ© Ø¨Ø¯ÙˆÙ† re-render ÙƒØ§Ù…Ù„
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateField(idx, field, val) {
  CURRENT_SCALE[idx][field] = parseFloat(val) || 0;
  calcRow(CURRENT_SCALE[idx]);
  const d = CURRENT_SCALE[idx];
  document.getElementById(`gross-${idx}` ).innerText = H.fmt(d.gross);
  document.getElementById(`gosi-${idx}`  ).innerText = H.fmt(d.gosi);
  document.getElementById(`saned-${idx}` ).innerText = H.fmt(d.saned);
  document.getElementById(`net-${idx}`   ).innerText = H.fmt(d.net);
  document.getElementById(`costhr-${idx}`).innerText = H.fmt(d.cost_hr, 2);
  document.getElementById(`othr-${idx}`  ).innerText = H.fmt(d.ot_hr, 2);
  markDirty();
}

function markDirty() {
  _dirty = true;
  document.getElementById('unsavedBadge').classList.add('show');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  Ø­ÙØ¸
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveScale() {
  Store.save('salary_scale_v1', CURRENT_SCALE);
  _dirty = false;
  document.getElementById('unsavedBadge').classList.remove('show');
  toast('âœ… ØªÙ… Ø­ÙØ¸ Ø³Ù„Ù… Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
  renderKPIs();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetScale() {
  if (!confirm('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³Ù„Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŸ Ø³ØªÙÙÙ‚Ø¯ ÙƒÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª.')) return;
  localStorage.removeItem('salary_scale_v1');
  CURRENT_SCALE = (APP.salaryScale || []).map(calcRow);
  _dirty = false;
  document.getElementById('unsavedBadge').classList.remove('show');
  renderTable();
  renderKPIs();
  toast('ğŸ”„ ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†', 'warn');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  ØªØµØ¯ÙŠØ± CSV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportCSV() {
  const headers = ['Ø§Ù„Ø³Ù†Ø© Ù…','Ø§Ù„Ø³Ù†Ø© Ù‡Ù€','Ø§Ù„Ø¹Ù…Ø±','Ø§Ù„Ø®Ø¯Ù…Ø©','Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ','Ø§Ù„Ø³ÙƒÙ†','Ø§Ù„Ù†Ù‚Ù„','Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ','GOSI','Ø³Ø§Ù†Ø¯','Ø§Ù„ØµØ§ÙÙŠ','ØªÙƒÙ„ÙØ© Ø§Ù„Ø³Ø§Ø¹Ø©','Ø£ÙˆÙØ± ØªØ§ÙŠÙ…'];
  const rows = CURRENT_SCALE.map(d => [
    d.year, d.hijri || '', d.age || '', d.exp || '',
    d.basic, d.housing, d.transport,
    d.gross.toFixed(2), d.gosi.toFixed(2), d.saned.toFixed(2), d.net.toFixed(2),
    d.cost_hr.toFixed(2), d.ot_hr.toFixed(2)
  ]);
  const csv = '\uFEFF' + [headers, ...rows].map(r => r.join(',')).join('\n');
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv;charset=utf-8;' }));
  a.download = `salary_scale_${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
  toast('ğŸ“„ ØªÙ… ØªØµØ¯ÙŠØ± CSV', 'success');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  ØªØµØ¯ÙŠØ± JSON
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportJSON() {
  const payload = {
    app: '2043',
    type: 'salary_scale',
    exportedAt: new Date().toISOString(),
    data: CURRENT_SCALE
  };
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' }));
  a.download = `salary_scale_${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  toast('ğŸ“¦ ØªÙ… ØªØµØ¯ÙŠØ± JSON', 'success');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  KPIs
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderKPIs() {
  const curr       = CURRENT_SCALE.find(d => d.year === CY) || CURRENT_SCALE[0] || {};
  const last       = CURRENT_SCALE[CURRENT_SCALE.length - 1] || {};
  const future     = CURRENT_SCALE.filter(d => d.year >= CY);
  const totalFuture = future.reduce((s, d) => s + (d.net || 0) * 12, 0);
  const avgNet      = future.length ? totalFuture / future.length / 12 : 0;

  document.getElementById('scaleKPIs').innerHTML = `
    <div class="kpi-card">
      <div class="kpi-icon">ğŸ’³</div>
      <div class="kpi-label">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
      <div class="kpi-value accent">${H.fmt(curr.net || 0)}</div>
      <div class="kpi-sub">SAR / Ø´Ù‡Ø±</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">ğŸ†</div>
      <div class="kpi-label">Ø£Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨ Ù…ØªÙˆÙ‚Ø¹</div>
      <div class="kpi-value pos">${H.fmt(last.net || 0)}</div>
      <div class="kpi-sub">${last.year || 'â€”'}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">ğŸ“Š</div>
      <div class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div>
      <div class="kpi-value" style="color:var(--purple)">${H.fmt(totalFuture)}</div>
      <div class="kpi-sub">SAR Ø­ØªÙ‰ ${2043}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">â³</div>
      <div class="kpi-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ</div>
      <div class="kpi-value warn">${H.fmt(avgNet)}</div>
      <div class="kpi-sub">SAR / Ø´Ù‡Ø± Ù…ØªÙˆØ³Ø· Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ</div>
    </div>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  ØªØ­Ø°ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ø¯ÙˆÙ† Ø­ÙØ¸
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('beforeunload', e => {
  if (_dirty) { e.preventDefault(); e.returnValue = ''; }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  Init
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderKPIs();
renderTable();
</script>
</body>
</html>
