<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³Ù„Ù… Ø§Ù„Ø±Ø§ØªØ¨ â€” 2043</title>
<link rel="stylesheet" href="assets/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="assets/data.js"></script>
<script src="assets/auth.js"></script>
<style>
.scale-table-wrap { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); overflow: auto; margin-bottom: 24px; }
.scale-table-wrap table { width: 100%; border-collapse: collapse; font-size: 12px; min-width: 1100px; }
.scale-table-wrap thead th { background: var(--bg2); color: var(--text3); font-weight: 700; padding: 10px; text-align: center; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 2; }
.scale-table-wrap tbody td { padding: 5px 10px; border-bottom: 1px solid var(--border); text-align: center; white-space: nowrap; }
.row-current td { background: rgba(79,142,247,0.08) !important; font-weight: 700; }
.field-inline { background: rgba(255,255,255,0.05); border: 1px solid transparent; color: inherit; padding: 4px; border-radius: 4px; text-align: center; font-family: inherit; }
.field-inline:focus { border-color: var(--accent); background: var(--bg); outline: none; }
</style>
</head>
<body>
<script>initPage('salary-scale');</script>
<div class="main">
  <div class="page-header">
    <div class="page-header-left">
      <h1>ğŸ“ˆ Ø³Ù„Ù… Ø§Ù„Ø±Ø§ØªØ¨</h1>
      <p>Ø£Ø®ØµØ§Ø¦ÙŠ Ø£ÙˆÙ„ Ù…Ø®ØªØ¨Ø±Ø§Øª â€” ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ù„Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</p>
    </div>
    <div class="page-header-right">
      <button class="btn btn-primary" onclick="saveScale()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
    </div>
  </div>
  <div class="kpi-grid cols-4" id="scaleKPIs"></div>
  <div class="scale-table-wrap">
    <table>
      <thead>
        <tr>
          <th>Ø§Ù„Ø³Ù†Ø© Ù‡Ù€</th><th>Ø§Ù„Ø³Ù†Ø© Ù…</th><th>Ø§Ù„Ø¹Ù…Ø±</th><th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
          <th>Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th><th>Ø¨Ø¯Ù„ Ø§Ù„Ø³ÙƒÙ†</th><th>Ø¨Ø¯Ù„ Ø§Ù„Ù†Ù‚Ù„</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
          <th>GOSI</th><th>Ø³Ø§Ù†Ø¯</th><th>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø§ØªØ¨</th>
          <th>Ø£ÙˆÙØ± ØªØ§ÙŠÙ…</th><th>ØªÙƒÙ„ÙØ© Ø§Ù„Ø³Ø§Ø¹Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
        </tr>
      </thead>
      <tbody id="scaleBody"></tbody>
    </table>
  </div>
</div>
<script>
const currentYear = new Date().getFullYear();
let CURRENT_SCALE = Store.load('salary_scale_v1', SCALE_DATA); // SCALE_DATA comes from current file or data.js

function renderTable() {
  document.getElementById('scaleBody').innerHTML = CURRENT_SCALE.map((d, i) => {
    const isPast = d.year < currentYear;
    const isCurrent = d.year === currentYear;
    return `
      <tr class="${isPast?'row-past':isCurrent?'row-current':'row-future'}">
        <td>${d.hijri}</td>
        <td style="font-weight:${isCurrent?'800':'400'}">${d.year}</td>
        <td>${d.age}</td>
        <td>${d.exp}</td>
        <td><input type="number" class="field-inline" style="width:80px;color:var(--accent)" value="${d.basic}" onchange="updateRow(${i},'basic',this.value)"></td>
        <td><input type="number" class="field-inline" style="width:70px" value="${d.housing}" onchange="updateRow(${i},'housing',this.value)"></td>
        <td><input type="number" class="field-inline" style="width:60px" value="${d.transport}" onchange="updateRow(${i},'transport',this.value)"></td>
        <td id="gross-${i}" style="font-weight:700">${H.fmt(d.gross)}</td>
        <td id="gosi-${i}" style="color:var(--red)">${H.fmt(d.gosi)}</td>
        <td id="saned-${i}" style="color:var(--red)">${H.fmt(d.saned)}</td>
        <td id="net-${i}" style="color:var(--green);font-weight:700">${H.fmt(d.net)}</td>
        <td><input type="number" class="field-inline" style="width:60px;color:var(--yellow)" value="${d.ot_hr.toFixed(2)}" onchange="updateRow(${i},'ot_hr',this.value)"></td>
        <td><input type="number" class="field-inline" style="width:60px" value="${d.cost_hr.toFixed(2)}" onchange="updateRow(${i},'cost_hr',this.value)"></td>
        <td>${isPast?'Ù…Ø§Ø¶ÙŠ':isCurrent?'Ø§Ù„Ø¢Ù† âœ¦':'Ù…Ø³ØªÙ‚Ø¨Ù„'}</td>
      </tr>`;
  }).join('');
}

function updateRow(idx, field, val) {
  let d = CURRENT_SCALE[idx];
  d[field] = parseFloat(val) || 0;
  d.gross = d.basic + d.housing + d.transport;
  d.gosi  = (d.basic + d.housing) * 0.0975; // 9% + 0.75%
  d.saned = (d.basic + d.housing) * 0.0075;
  d.net   = d.gross - d.gosi - d.saned;
  
  document.getElementById(`gross-${idx}`).innerText = H.fmt(d.gross);
  document.getElementById(`gosi-${idx}`).innerText = H.fmt(d.gosi);
  document.getElementById(`saned-${idx}`).innerText = H.fmt(d.saned);
  document.getElementById(`net-${idx}`).innerText = H.fmt(d.net);
}

function saveScale() {
  Store.save('salary_scale_v1', CURRENT_SCALE);
  toast('âœ… ØªÙ… Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø³Ù„Ù… Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø¨Ù†Ø¬Ø§Ø­','success');
  renderKPIs();
}

function renderKPIs() {
  const curr = CURRENT_SCALE.find(d => d.year === currentYear) || CURRENT_SCALE[0];
  const last = CURRENT_SCALE[CURRENT_SCALE.length-1];
  const totalFuture = CURRENT_SCALE.filter(d => d.year >= currentYear).reduce((s,d) => s + d.net * 12, 0);
  
  document.getElementById('scaleKPIs').innerHTML = `
    <div class="kpi-card"><div class="kpi-label">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</div><div class="kpi-value accent">${H.fmt(curr.net)}</div></div>
    <div class="kpi-card"><div class="kpi-label">Ø£Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨ Ù…ØªÙˆÙ‚Ø¹</div><div class="kpi-value pos">${H.fmt(last.net)}</div></div>
    <div class="kpi-card"><div class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div><div class="kpi-value" style="color:var(--purple)">${H.fmt(totalFuture)}</div></div>
    <div class="kpi-card"><div class="kpi-label">Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</div><div class="kpi-value warn">${2043 - currentYear}</div></div>`;
}

renderKPIs(); renderTable();
</script>
</body>
</html>
