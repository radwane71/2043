function renderRanks() {
  const byS = totalByStock();

  // â”€â”€ Ø£Ø¹Ù„Ù‰ 5 Ø¥Ø¬Ù…Ø§Ù„Ø§Ù‹ â”€â”€ (Ø¨Ø¯ÙˆÙ† Ø´Ø±Ø·)
  document.getElementById('top5total').innerHTML =
    byS.slice(0,5).map((d,i) =>
      rankCard(i, d.stock, H.fmt(d.total)+' SAR', d.arr.length+' Ø¯ÙØ¹Ø©')
    ).join('') || '<p class="muted" style="padding:16px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';

  // â”€â”€ Ø£ÙØ¶Ù„ 5 Ø«Ø¨Ø§ØªØ§Ù‹ â”€â”€ ÙŠØ´ØªØ±Ø· 5+ Ø¯ÙØ¹Ø§Øª
  const stabArr = byS.filter(d => d.arr.length >= 5)
    .map(d => ({...d, cvVal: cv(d.arr)}))
    .sort((a,b) => a.cvVal - b.cvVal);
  document.getElementById('top5stable').innerHTML = stabArr.length
    ? stabArr.slice(0,5).map((d,i) =>
        rankCard(i, d.stock, 'ØªØ°Ø¨Ø°Ø¨ '+(d.cvVal*100).toFixed(1)+'%', d.arr.length+' Ø¯ÙØ¹Ø©')
      ).join('')
    : '<p class="muted" style="padding:16px">âš ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ© â€” ÙŠØ­ØªØ§Ø¬ 5 Ø¯ÙØ¹Ø§Øª Ù„ÙƒÙ„ Ø³Ù‡Ù…</p>';

  // â”€â”€ Ø£ÙƒØ¨Ø± 5 Ù†Ù…ÙˆØ§Ù‹ â”€â”€ ÙŠØ´ØªØ±Ø· 5+ Ø¯ÙØ¹Ø§Øª ÙˆÙÙŠÙ‡ Ù†Ù…Ùˆ ÙØ¹Ù„ÙŠ
  const growArr = byS.filter(d => d.arr.length >= 5)
    .map(d => ({...d, gVal: growth(d.arr)}))
    .filter(d => d.gVal > 0)
    .sort((a,b) => b.gVal - a.gVal);
  document.getElementById('top5growth').innerHTML = growArr.length
    ? growArr.slice(0,5).map((d,i) =>
        rankCard(i, d.stock,
          '+'+H.fmt(d.gVal*100,1)+'%',
          H.fmt(d.arr[0])+' â† '+H.fmt(d.arr[d.arr.length-1]))
      ).join('')
    : '<p class="muted" style="padding:16px">âš ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ© â€” ÙŠØ­ØªØ§Ø¬ 5 Ø¯ÙØ¹Ø§Øª Ø¨Ù†Ù…Ùˆ Ù…ÙˆØ«Ù‘Ù‚</p>';

  // â”€â”€ Ø£Ù‚Ù„ 5 ØªÙˆØ²ÙŠØ¹Ø§Ù‹ â”€â”€ ÙÙ‚Ø· Ù…Ù† ÙˆØ²Ù‘Ø¹ (Ø¨Ø¯ÙˆÙ† Ø£ØµÙØ§Ø±)
  const lowestArr = [...byS]
    .filter(d => d.total > 0)
    .sort((a,b) => a.total - b.total);
  document.getElementById('top5lowest').innerHTML = lowestArr.length
    ? lowestArr.slice(0,5).map((d,i) =>
        rankCard(i, d.stock, H.fmt(d.total)+' SAR', d.arr.length+' Ø¯ÙØ¹Ø©')
      ).join('')
    : '<p class="muted" style="padding:16px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';

  // â”€â”€ Ø£Ø¹Ù„Ù‰ 5 ØªØ°Ø¨Ø°Ø¨Ø§Ù‹ â”€â”€ ÙŠØ´ØªØ±Ø· 5+ Ø¯ÙØ¹Ø§Øª
  const volArr = byS.filter(d => d.arr.length >= 5)
    .map(d => ({...d, cvVal: cv(d.arr)}))
    .sort((a,b) => b.cvVal - a.cvVal);
  document.getElementById('top5volatile').innerHTML = volArr.length
    ? volArr.slice(0,5).map((d,i) =>
        rankCard(i, d.stock, 'ØªØ°Ø¨Ø°Ø¨ '+(d.cvVal*100).toFixed(1)+'%', d.arr.length+' Ø¯ÙØ¹Ø©')
      ).join('')
    : '<p class="muted" style="padding:16px">âš ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ© â€” ÙŠØ­ØªØ§Ø¬ 5 Ø¯ÙØ¹Ø§Øª Ù„ÙƒÙ„ Ø³Ù‡Ù…</p>';

  // â”€â”€ Ø£Ø³Ù‡Ù… Ù…Ø¶Ù‰ Ø¹Ù„ÙŠÙ‡Ø§ Ø³Ù†Ø© ÙˆÙ„Ù… ØªÙˆØ²Ø¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const transactions = Store.load('transactions_v1', APP.transactions);
  const oneYearAgo   = new Date();
  oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);

  // Ø£ÙˆÙ„ Ø´Ø±Ø§Ø¡ Ù„ÙƒÙ„ ØªÙŠÙƒØ± Ù…Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
  const firstBuy = {};
  transactions
    .filter(t => t.status === 'Buy')
    .forEach(t => {
      const ticker = t.ticker;
      // Ø±Ø¨Ø· Ø§Ù„ØªÙŠÙƒØ± Ø¨Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©
      const port = APP.portfolio.find(p => p.ticker === ticker || p.stock === ticker);
      const name = port?.stock || ticker;
      if (!firstBuy[name]) firstBuy[name] = t.date || null;
      else if (t.date && t.date < firstBuy[name]) firstBuy[name] = t.date;
    });

  const divStocks = new Set(divData.map(d => d.stock));

  const neverPaid = APP.portfolio
    .filter(p => {
      const name     = p.stock;
      const buyDate  = firstBuy[name];
      if (!buyDate) return false;
      const owned    = new Date(buyDate) <= oneYearAgo;
      const noPaid   = !divStocks.has(name);
      return owned && noPaid;
    });

  // Ø£Ø¶Ù Ø§Ù„Ù‚Ø³Ù… Ø¥Ø°Ø§ Ù…Ø§ Ù…ÙˆØ¬ÙˆØ¯
  let neverBox = document.getElementById('top5neverpaid');
  if (!neverBox) {
    neverBox = document.createElement('div');
    neverBox.id = 'top5neverpaid';
    neverBox.className = 'chart-card';
    neverBox.style.marginBottom = '24px';
    // Ø£Ø¶ÙÙ‡ Ø¨Ø¹Ø¯ top5volatile
    document.getElementById('top5volatile').closest('.chart-card')
      .insertAdjacentElement('afterend', neverBox);
  }

  neverBox.innerHTML = `
    <div class="section-title">ğŸš¨ Ø£Ø³Ù‡Ù… ØªØ¬Ø§ÙˆØ² Ø§Ù…ØªÙ„Ø§ÙƒÙ‡Ø§ Ø³Ù†Ø© ÙˆÙ„Ù… ØªÙˆØ²Ø¹</div>
    ${neverPaid.length
      ? `<div class="rank-grid">
          ${neverPaid.map((p,i) => rankCard(i,
            p.stock,
            'Ù…Ù†Ø° '+firstBuy[p.stock],
            'Ù„Ù… ÙŠÙˆØ²Ø¹ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹'
          )).join('')}
         </div>`
      : '<p class="muted" style="padding:16px">âœ… ÙƒÙ„ Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„ØªÙŠ Ù…Ø¶Ù‰ Ø¹Ù„ÙŠÙ‡Ø§ Ø³Ù†Ø© ÙˆØ²Ù‘Ø¹Øª</p>'
    }`;
}
