<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<link rel="icon" href="data:,">
<title>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª â€” 2043</title>
<link rel="stylesheet" href="assets/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="assets/tickers.js"></script>
<script src="assets/data.js"></script>
<script src="assets/store.js"></script>
<script src="assets/auth.js"></script>
<script src="assets/data-sync.js"></script>
<script src="assets/ticker-helper.js"></script>
<style>
.editable {
  cursor: pointer;
  border-bottom: 1px dashed var(--border2);
  transition: border-color 0.2s;
  display: inline-block;
  min-width: 40px;
}
.editable:hover { border-color: var(--accent); color: var(--accent); }

.edit-input {
  width: 90px;
  padding: 4px 6px;
  background: var(--bg2);
  border: 1px solid var(--accent);
  border-radius: 4px;
  color: var(--text);
  font-size: 12px;
  text-align: center;
  outline: none;
  font-family: inherit;
}

.filter-tabs {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}
.filter-tab {
  padding: 6px 14px;
  border-radius: 20px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text3);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.18s;
  font-family: inherit;
}
.filter-tab:hover { border-color: var(--accent); color: var(--accent); }
.filter-tab.active { background: var(--accent); border-color: var(--accent); color: #fff; }
.filter-tab.sell-active { background: var(--red); border-color: var(--red); color: #fff; }

.import-zone {
  border: 2px dashed var(--border2);
  border-radius: var(--radius);
  padding: 24px;
  text-align: center;
  color: var(--text3);
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 12px;
}
.import-zone:hover {
  border-color: var(--accent);
  color: var(--accent);
  background: rgba(79,142,247,0.04);
}

.row-deleted { opacity: 0.4; text-decoration: line-through; }

.ticker-name-preview {
  font-size: 11px;
  margin-top: 4px;
  min-height: 16px;
  font-weight: 600;
  transition: color 0.2s;
}
</style>
</head>
<body>
<script>initPage('transactions');</script>

<div class="main">

  <!-- Header -->
  <div class="page-header">
    <div class="page-header-left">
      <h1>ğŸ”„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h1>
      <p>Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ø¨ÙŠØ¹ â€” Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·ØŒ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ÙƒÙˆØ¯ Ø§Ù„ØªÙŠÙƒØ± (4 Ø£Ø±Ù‚Ø§Ù…)</p>
    </div>
    <div class="page-header-right" style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn btn-ghost btn-sm" onclick="seedOct2025()">ğŸ“Œ Ø¥Ø¯Ø±Ø§Ø¬ Ø¹Ù…Ù„ÙŠØ§Øª 1 Ø£ÙƒØªÙˆØ¨Ø± 2025</button>
      <button class="btn btn-ghost btn-sm" onclick="exportCSV()">ğŸ“¥ ØªØµØ¯ÙŠØ± CSV</button>
      <button class="btn btn-ghost btn-sm" onclick="exportJSON()">ğŸ“¦ ØªØµØ¯ÙŠØ± JSON</button>
      <button class="btn btn-warn btn-sm"  onclick="document.getElementById('importModal').style.display='flex'">ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
      <button class="btn btn-primary btn-sm" onclick="saveAll()">ğŸ’¾ Ø­ÙØ¸</button>
    </div>
  </div>

  <div class="info-box blue" id="seedInfo" style="margin-bottom:14px;display:none"></div>

  <!-- KPIs -->
  <div class="kpi-grid cols-5" id="trKPIs"></div>

  <!-- Add Transaction Form -->
  <div class="form-card">
    <h3>â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h3>
    <div class="form-row">
      <div class="form-group">
        <label>Ø§Ù„Ù†ÙˆØ¹</label>
        <select id="t-status">
          <option value="Buy">Ø´Ø±Ø§Ø¡ â€” Buy</option>
          <option value="Sell">Ø¨ÙŠØ¹ â€” Sell</option>
        </select>
      </div>
      <div class="form-group">
        <label>ÙƒÙˆØ¯ Ø§Ù„ØªÙŠÙƒØ±</label>
        <input id="t-ticker" placeholder="2222" autocomplete="off" oninput="fetchTickerName()" style="text-transform:uppercase;letter-spacing:1px">
        <div class="ticker-name-preview" id="t-name-preview"></div>
      </div>
      <div class="form-group">
        <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
        <input id="t-qty" type="number" min="1" placeholder="100">
      </div>
      <div class="form-group">
        <label>Ø§Ù„Ø³Ø¹Ø±</label>
        <input id="t-price" type="number" step="0.01" placeholder="25.50" oninput="calcPreview()">
      </div>
      <div class="form-group">
        <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
        <input id="t-date" type="date">
      </div>
    </div>

    <!-- Preview -->
    <div id="addPreview" style="display:none;margin-bottom:14px;padding:12px 16px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;font-size:13px;display:flex;gap:24px;flex-wrap:wrap">
      <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <strong id="prev-total" class="accent">â€”</strong></span>
      <span>Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©: <strong id="prev-comm" style="color:var(--text3)">â€”</strong></span>
      <span>VAT: <strong id="prev-vat" style="color:var(--text3)">â€”</strong></span>
      <span>ØµØ§ÙÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©: <strong id="prev-net" class="pos">â€”</strong></span>
    </div>

    <button class="btn btn-primary" onclick="addTransaction()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
  </div>

  <!-- Filters -->
  <div class="toolbar">
    <div class="filter-tabs">
      <button class="filter-tab active" onclick="applyFilter('all',this)">Ø§Ù„ÙƒÙ„</button>
      <button class="filter-tab" onclick="applyFilter('Buy',this)">Ø´Ø±Ø§Ø¡ ÙÙ‚Ø·</button>
      <button class="filter-tab" onclick="applyFilter('Sell',this)">Ø¨ÙŠØ¹ ÙÙ‚Ø·</button>
    </div>
    <input class="search-input" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„ØªÙŠÙƒØ± Ø£Ùˆ Ø§Ù„Ø§Ø³Ù…..." oninput="applySearch(this.value)">
  </div>

  <!-- Table -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Ø§Ù„Ù†ÙˆØ¹</th>
          <th>Ø§Ù„ØªÙŠÙƒØ±</th>
          <th>Ø§Ù„Ø§Ø³Ù…</th>
          <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
          <th>Ø§Ù„Ø³Ø¹Ø±</th>
          <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
          <th>Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</th>
          <th>VAT</th>
          <th>ØµØ§ÙÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©</th>
          <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
        </tr>
      </thead>
      <tbody id="trBody"></tbody>
    </table>
  </div>

</div>

<!-- â•â• Import Modal â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="importModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:500;align-items:center;justify-content:center">
  <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:28px;width:90%;max-width:520px">
    <h3 style="margin-bottom:16px;font-size:16px">ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>

    <div class="info-box blue" style="margin-bottom:16px">
      ÙŠØ¯Ø¹Ù… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„ÙØ§Øª <strong>JSON</strong> Ø£Ùˆ <strong>CSV</strong> Ø¨Ù†ÙØ³ ØµÙŠØºØ© Ø§Ù„ØªØµØ¯ÙŠØ±.
    </div>

    <div class="import-zone" onclick="document.getElementById('fileInput').click()">
      <div style="font-size:32px;margin-bottom:8px">ğŸ“</div>
      <div>Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£Ùˆ Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª</div>
      <div style="font-size:11px;margin-top:4px">JSON / CSV</div>
    </div>
    <input id="fileInput" type="file" accept=".json,.csv" style="display:none" onchange="handleImport(this)">

    <div style="margin-top:16px">
      <label style="font-size:12px;color:var(--text3);font-weight:700;text-transform:uppercase;letter-spacing:.4px;display:block;margin-bottom:6px">
        Ø£Ùˆ Ø§Ù„ØµÙ‚ JSON Ù…Ø¨Ø§Ø´Ø±Ø©
      </label>
      <textarea id="jsonPaste" rows="5"
        style="width:100%;padding:10px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:12px;font-family:monospace;outline:none;resize:vertical"
        placeholder='[{"no":1,"status":"Buy","ticker":"2222","qty":100,...}]'></textarea>
    </div>

    <div style="display:flex;gap:10px;margin-top:16px;justify-content:flex-end">
      <button class="btn btn-ghost" onclick="document.getElementById('importModal').style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="btn btn-primary" onclick="doImport()">Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ¯Ù…Ø¬</button>
      <button class="btn btn-danger"  onclick="doImportReplace()">Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„</button>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  Seed: Oct 1, 2025
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SEED_DATE = '2025-10-01';
const SEED_DONE_KEY = 'seed_tx_2025_10_01_done_v1';

function showSeedInfo() {
  const box = document.getElementById('seedInfo');
  const done = Store.get(SEED_DONE_KEY) === '1';

  if (!box) return;
  box.style.display = 'block';
  box.innerHTML = done
    ? `âœ… ØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ø¹Ù…Ù„ÙŠØ§Øª ${SEED_DATE} Ù…Ø³Ø¨Ù‚Ø§Ù‹. (Ù„Ù† ØªØªÙƒØ±Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)`
    : `ğŸ“Œ Ù„Ø¯ÙŠÙƒ Ø®ÙŠØ§Ø± Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø¨ØªØ§Ø±ÙŠØ® ${SEED_DATE}. Ø³ÙŠØªÙ… Ø±Ø¨Ø· ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙƒÙˆØ¯ ØªÙŠÙƒØ± ØµØ­ÙŠØ­ (4 Ø£Ø±Ù‚Ø§Ù…).`;
}

function buildSeedFromAPP() {
  const base = (APP.transactions || []).map((t, i) => ({
    ...t,
    no: i + 1,
    date: SEED_DATE,
  }));

  const normalized = (window.normalizeTransactions ? normalizeTransactions(base) : base)
    .map(t => ({ ...t }));

  const bad = [];
  normalized.forEach(t => {
    const code = String(t.ticker || '');
    if (!window.TickerHelper?.isValid(code)) {
      bad.push({ no: t.no, ticker: t.ticker, status: t.status, qty: t.qty, price: t.price });
    }
  });

  if (bad.length) {
    return { ok: false, bad, data: normalized };
  }

  // ÙØ±Ø¶ 4 Ø£Ø±Ù‚Ø§Ù…
  normalized.forEach(t => {
    t.ticker = String(window.TickerHelper?.normalizeCode(t.ticker) || t.ticker).padStart(4, '0');
  });

  return { ok: true, data: normalized };
}

function seedOct2025() {
  if (Store.get(SEED_DONE_KEY) === '1') {
    return toast(`â„¹ï¸ Ø¹Ù…Ù„ÙŠØ§Øª ${SEED_DATE} Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹`, 'info');
  }

  // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„ØªÙŠÙƒØ±-Ù‡ÙŠÙ„Ø¨Ø± Ø¬Ø§Ù‡Ø²
  if (!window.TickerHelper?.isValid) {
    return toast('âŒ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙŠÙƒØ± ØºÙŠØ± Ø¬Ø§Ù‡Ø². Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.', 'error');
  }

  let mode = 'replace';
  if (trData.length > 0) {
    const wantsReplace = confirm(`Ø¹Ù†Ø¯Ùƒ Ø§Ù„Ø¢Ù† ${trData.length} Ø¹Ù…Ù„ÙŠØ©.\n\nÙ…ÙˆØ§ÙÙ‚ = Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙƒÙ„ Ø¨Ø¹Ù…Ù„ÙŠØ§Øª ${SEED_DATE}.\nØ¥Ù„ØºØ§Ø¡ = Ø¯Ù…Ø¬ ÙˆØ¥Ø¶Ø§ÙØ© ÙÙ‚Ø·.`);
    mode = wantsReplace ? 'replace' : 'merge';
  }

  const r = buildSeedFromAPP();
  if (!r.ok) {
    console.table(r.bad);
    toast(`âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬: ÙÙŠÙ‡ ${r.bad.length} ØªÙŠÙƒØ±Ø§Øª ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©. Ø§ÙØªØ­ Console Ù„Ù„ØªÙØ§ØµÙŠÙ„.`, 'error');
    return;
  }

  let newData;
  if (mode === 'replace') {
    newData = r.data.map((t, i) => ({ ...t, no: i + 1 }));
  } else {
    const startNo = trData.length + 1;
    const toAdd = r.data.map((t, i) => ({ ...t, no: startNo + i }));
    newData = [...trData, ...toAdd];
  }

  // Ø­ÙØ¸ ÙÙŠ Store
  updateTransactions(() => newData);

  // ØªØ­Ø¯ÙŠØ« trData Ù…Ù† Store Ù…Ø¨Ø§Ø´Ø±Ø©
  trData = Store.load('transactions_v1', APP.transactions) || [];
  trData = (window.normalizeTransactions ? normalizeTransactions(trData) : trData);

  // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø­ÙØ¸Ø©
  try { recalculatePortfolioFromTransactions(); } catch(e) {}

  applyFilters();
  renderKPIs();
  Store.save(SEED_DONE_KEY, '1');
  showSeedInfo();

  toast(`âœ… ØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ø¹Ù…Ù„ÙŠØ§Øª ${SEED_DATE} Ø¨Ù†Ø¬Ø§Ø­`, 'success');

  // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ© Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª
  try { syncAfterTransactionChange(); } catch(e) {}
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  State
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let trData   = (Store.load('transactions_v1', APP.transactions) || []).map(t => ({...t}));
trData       = (window.normalizeTransactions ? normalizeTransactions(trData) : trData);
let filtered = [...trData];
let activeF  = 'all';
let searchQ  = '';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  Helper: Ø¯Ù…Ø¬ Ø§Ù„ØªÙŠÙƒØ±Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ø¹ Ø§Ù„Ù…Ø®ØµØµØ©
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getAllTickers() {
  return [...TICKERS, ...Store.load('custom_tickers', [])];
}

function lookupTicker(code) {
  return window.TickerHelper?.search(code) || null;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  Auto-fetch ticker name on input
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fetchTickerName() {
  const code    = document.getElementById('t-ticker').value.trim().toUpperCase();
  const preview = document.getElementById('t-name-preview');
  const found   = lookupTicker(code);

  if (!code) { 
    preview.textContent = ''; 
    return; 
  }
  
  if (found) {
    preview.textContent = 'âœ“ ' + found.name;
    preview.style.color = 'var(--green)';
  } else {
    preview.textContent = 'âŒ ÙƒÙˆØ¯ Ø§Ù„ØªÙŠÙƒØ± ØºÙŠØ± Ù…Ø¹Ø±Ù‘Ù';
    preview.style.color = 'var(--red)';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  KPIs
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderKPIs() {
  const buys    = trData.filter(t => t.status === 'Buy');
  const sells   = trData.filter(t => t.status === 'Sell');
  const buyAmt  = buys.reduce((s,t)  => s + (t.total||0), 0);
  const sellAmt = sells.reduce((s,t) => s + (t.total||0), 0);
  const fees    = trData.reduce((s,t) => s + (t.commission||0) + (t.vat||0), 0);
  const net     = buyAmt - sellAmt;

  document.getElementById('trKPIs').innerHTML = `
    <div class="kpi-card">
      <div class="kpi-icon">ğŸ”¢</div>
      <div class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
      <div class="kpi-value">${trData.length}</div>
      <div class="kpi-sub">${buys.length} Ø´Ø±Ø§Ø¡ / ${sells.length} Ø¨ÙŠØ¹</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">â¬†ï¸</div>
      <div class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø±Ø§Ø¡</div>
      <div class="kpi-value pos">${H.fmt(buyAmt)}</div>
      <div class="kpi-sub">SAR</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">â¬‡ï¸</div>
      <div class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨ÙŠØ¹</div>
      <div class="kpi-value neg">${H.fmt(sellAmt)}</div>
      <div class="kpi-sub">SAR</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">ğŸ’¸</div>
      <div class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª + VAT</div>
      <div class="kpi-value warn">${H.fmt(fees)}</div>
      <div class="kpi-sub">SAR</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">ğŸ”„</div>
      <div class="kpi-label">ØµØ§ÙÙŠ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</div>
      <div class="kpi-value accent">${H.fmt(net)}</div>
      <div class="kpi-sub">Ø´Ø±Ø§Ø¡ âˆ’ Ø¨ÙŠØ¹</div>
    </div>
  `;
}

// ... [REST OF THE CODE REMAINS THE SAME] ...
