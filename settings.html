<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<link rel="icon" href="data:,">
<title>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â€” 2043</title>
<link rel="stylesheet" href="assets/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="assets/tickers.js"></script>
<script src="assets/data.js"></script>
<script src="assets/auth.js"></script>
<script src="assets/data-sync.js"></script>
<style>
.settings-section {
  background:var(--card); border:1px solid var(--border);
  border-radius:var(--radius); padding:24px; margin-bottom:20px;
}
.settings-section h3 { margin:0 0 16px; font-size:18px; }
.settings-item {
  display:flex; justify-content:space-between; align-items:center;
  padding:16px 0; border-bottom:1px solid var(--border);
}
.settings-item:last-child { border-bottom:none; }
.settings-label { font-size:14px; font-weight:600; }
.settings-desc { font-size:12px; color:var(--text3); margin-top:4px; }
.theme-switch {
  display:flex; gap:8px; background:var(--bg2);
  border-radius:20px; padding:4px;
}
.theme-switch button {
  padding:8px 16px; border-radius:16px; border:none;
  background:transparent; color:var(--text3);
  cursor:pointer; transition:all .2s; font-family:inherit;
  font-size:13px; font-weight:600;
}
.theme-switch button.active {
  background:var(--accent); color:#fff;
}
</style>
</head>
<body>
<script>initPage('settings');</script>

<div class="main">

  <div class="page-header">
    <div class="page-header-left">
      <h1>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
      <p>ØªØ®ØµÙŠØµ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
    </div>
  </div>

  <div class="settings-section">
    <h3>ğŸ¨ Ø§Ù„Ù…Ø¸Ù‡Ø±</h3>
    <div class="settings-item">
      <div>
        <div class="settings-label">Ø§Ù„Ø«ÙŠÙ…</div>
        <div class="settings-desc">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ù…ÙØ¶Ù„</div>
      </div>
      <div class="theme-switch">
        <button onclick="setTheme('light')" id="theme-light">â˜€ï¸ ÙØ§ØªØ­</button>
        <button onclick="setTheme('dark')" id="theme-dark">ğŸŒ™ Ø¯Ø§ÙƒÙ†</button>
      </div>
    </div>
  </div>

  <div class="settings-section">
    <h3>ğŸ” Ø§Ù„Ø£Ù…Ø§Ù†</h3>
    <div class="settings-item">
      <div>
        <div class="settings-label">ØªØºÙŠÙŠØ± Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
        <div class="settings-desc">ØªØ­Ø¯ÙŠØ« Ø±Ù…Ø² PIN Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</div>
      </div>
      <button class="btn btn-primary btn-sm" onclick="changePin()">ØªØºÙŠÙŠØ±</button>
    </div>
  </div>

  <div class="settings-section">
    <h3>ğŸ’¾ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
    <div class="settings-item">
      <div>
        <div class="settings-label">ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
        <div class="settings-desc">Ø§Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙƒØ§Ù…Ù„Ø© (JSON)</div>
      </div>
      <button class="btn btn-ghost btn-sm" onclick="exportAll()">ğŸ“¦ ØªØµØ¯ÙŠØ±</button>
    </div>
    <div class="settings-item">
      <div>
        <div class="settings-label">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
        <div class="settings-desc">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</div>
      </div>
      <button class="btn btn-warn btn-sm" onclick="showImport()">ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
    </div>
    <div class="settings-item">
      <div>
        <div class="settings-label">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
        <div class="settings-desc">âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</div>
      </div>
      <button class="btn btn-danger btn-sm" onclick="deleteAll()">ğŸ—‘ï¸ Ø­Ø°Ù</button>
    </div>
  </div>

  <div class="settings-section">
    <h3>â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h3>
    <div class="settings-item">
      <div>
        <div class="settings-label">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</div>
        <div class="settings-desc">2043 v1.0.0</div>
      </div>
    </div>
    <div class="settings-item">
      <div>
        <div class="settings-label">ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</div>
        <div class="settings-desc" id="lastBackup">Ù„Ù… ÙŠØªÙ… Ø£Ø®Ø° Ù†Ø³Ø®Ø© Ø¨Ø¹Ø¯</div>
      </div>
    </div>
  </div>

</div>

<!-- Import Modal -->
<div id="importModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:500;align-items:center;justify-content:center">
  <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:28px;width:90%;max-width:500px">
    <h3 style="margin-bottom:16px">ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
    <div class="info-box blue" style="margin-bottom:14px">Ø³ÙŠØªÙ… <strong>Ø§Ø³ØªØ¨Ø¯Ø§Ù„</strong> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</div>
    <div style="border:2px dashed var(--border2);border-radius:var(--radius);padding:20px;text-align:center;color:var(--text3);cursor:pointer"
         onclick="document.getElementById('importFileInput').click()">ğŸ“ Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù JSON</div>
    <input id="importFileInput" type="file" accept=".json" style="display:none" onchange="handleImportFile(this)">
    <textarea id="importPaste" rows="8"
      style="width:100%;margin-top:14px;padding:10px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:11px;font-family:monospace;outline:none;resize:vertical"
      placeholder='{"transactions":[],"portfolio":[],...}'></textarea>
    <div style="display:flex;gap:10px;margin-top:14px;justify-content:flex-end">
      <button class="btn btn-ghost" onclick="closeImport()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="btn btn-danger" onclick="doImport()">Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Init
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  const currentTheme = Store.load('theme', 'light');
  document.getElementById('theme-' + currentTheme).classList.add('active');
  
  const lastBackupDate = Store.load('last_backup_date', null);
  if (lastBackupDate) {
    document.getElementById('lastBackup').textContent = lastBackupDate;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Theme
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  Store.save('theme', theme);
  
  document.querySelectorAll('.theme-switch button').forEach(b => b.classList.remove('active'));
  document.getElementById('theme-' + theme).classList.add('active');
  
  toast('âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø±', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Change PIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function changePin() {
  const oldPin = prompt('Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² PIN Ø§Ù„Ù‚Ø¯ÙŠÙ…:');
  if (!oldPin) return;
  
  if (!AUTH.login(oldPin)) {
    toast('âŒ Ø±Ù…Ø² PIN Ø§Ù„Ù‚Ø¯ÙŠÙ… ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
    return;
  }
  
  const newPin = prompt('Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² PIN Ø§Ù„Ø¬Ø¯ÙŠØ¯ (4 Ø£Ø±Ù‚Ø§Ù…):');
  if (!newPin || newPin.length < 4) {
    toast('âš ï¸ Ø±Ù…Ø² PIN ØºÙŠØ± ØµØ­ÙŠØ­', 'warn');
    return;
  }
  
  const confirmPin = prompt('ØªØ£ÙƒÙŠØ¯ Ø±Ù…Ø² PIN Ø§Ù„Ø¬Ø¯ÙŠØ¯:');
  if (newPin !== confirmPin) {
    toast('âš ï¸ Ø§Ù„Ø±Ù…Ø²Ø§Ù† ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø§Ù†', 'warn');
    return;
  }
  
  AUTH.changePin(newPin);
  toast('âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø±Ù…Ø² PIN Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Export All
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportAll() {
  const backup = {
    version: '1.0.0',
    date: H.today(),
    data: {
      transactions: APP.transactions,
      portfolio: APP.portfolio,
      dividends: APP.dividends,
      properties: APP.properties,
      gold: APP.gold,
      cash: APP.cash,
      cashinvest: APP.cashinvest,
      savings: APP.savings,
      goals: APP.goals
    }
  };
  
  const json = JSON.stringify(backup, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `2043_backup_${H.today()}.json`;
  link.click();
  
  Store.save('last_backup_date', H.today());
  document.getElementById('lastBackup').textContent = H.today();
  
  toast('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Import
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showImport() {
  document.getElementById('importModal').style.display = 'flex';
}

function closeImport() {
  document.getElementById('importModal').style.display = 'none';
  document.getElementById('importPaste').value = '';
}

function handleImportFile(input) {
  const file = input.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = (e) => {
    document.getElementById('importPaste').value = e.target.result;
  };
  reader.readAsText(file);
}

function doImport() {
  const raw = document.getElementById('importPaste').value.trim();
  if (!raw) {
    toast('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯', 'warn');
    return;
  }
  
  try {
    const backup = JSON.parse(raw);
    
    if (!backup.data) {
      toast('âŒ ØªÙ†Ø³ÙŠÙ‚ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
      return;
    }
    
    if (!confirm('âš ï¸ Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;
    
    // Save all data
    Store.save('transactions_v1', backup.data.transactions || []);
    Store.save('portfolio_v1', backup.data.portfolio || []);
    Store.save('dividends_v1', backup.data.dividends || []);
    Store.save('properties_v1', backup.data.properties || []);
    Store.save('gold_v1', backup.data.gold || []);
    Store.save('cash_v1', backup.data.cash || []);
    Store.save('cashinvest_v1', backup.data.cashinvest || []);
    Store.save('savings_v1', backup.data.savings || []);
    Store.save('goals_v1', backup.data.goals || []);
    
    closeImport();
    toast('âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
    
    setTimeout(() => {
      window.location.href = 'dashboard.html';
    }, 1500);
    
  } catch(e) {
    toast('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Delete All
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function deleteAll() {
  if (!confirm('âš ï¸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;
  if (!confirm('âš ï¸ ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠ: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹!')) return;
  
  // Keep auth only
  const pinHash = localStorage.getItem('pin_hash');
  localStorage.clear();
  if (pinHash) localStorage.setItem('pin_hash', pinHash);
  
  toast('âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
  
  setTimeout(() => {
    window.location.href = 'dashboard.html';
  }, 1500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Run
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
init();
</script>

</body>
</html>
