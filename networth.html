<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<link rel="icon" href="data:,">
<title>ØµØ§ÙÙŠ Ø§Ù„Ø«Ø±ÙˆØ© â€” 2043</title>
<link rel="stylesheet" href="assets/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="assets/tickers.js"></script>
<script src="assets/data.js"></script>
<script src="assets/auth.js"></script>
<script src="assets/data-sync.js"></script>
<style>
.chart-wrap { position:relative; width:100%; height:300px; }
.chart-wrap canvas { width:100% !important; height:100% !important; }
.snapshot-item {
  background:var(--card); border:1px solid var(--border);
  border-radius:var(--radius); padding:16px; margin-bottom:12px;
  display:flex; justify-content:space-between; align-items:center;
}
.snapshot-item .date { font-weight:700; font-size:14px; }
.snapshot-item .value { font-size:18px; font-weight:800; color:var(--accent); }
.snapshot-item .delete { cursor:pointer; color:var(--red); }
</style>
</head>
<body>
<script>initPage('networth');</script>

<div class="main">

  <div class="page-header">
    <div class="page-header-left">
      <h1>ğŸ“Š ØµØ§ÙÙŠ Ø§Ù„Ø«Ø±ÙˆØ©</h1>
      <p>ØªØªØ¨Ø¹ Ù†Ù…Ùˆ Ø«Ø±ÙˆØªÙƒ Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù†</p>
    </div>
    <div class="page-header-right">
      <button class="btn btn-primary btn-sm" onclick="takeSnapshot()">ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø©</button>
    </div>
  </div>

  <div class="kpi-grid cols-5" id="networthKPIs"></div>

  <div class="chart-grid cols-2">
    <div class="chart-card">
      <div class="chart-title">ğŸ“ˆ ØªØ·ÙˆØ± ØµØ§ÙÙŠ Ø§Ù„Ø«Ø±ÙˆØ©</div>
      <div class="chart-wrap"><canvas id="networthChart"></canvas></div>
    </div>
    <div class="chart-card">
      <div class="chart-title">ğŸ° Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</div>
      <div class="chart-wrap"><canvas id="categoryChart"></canvas></div>
    </div>
  </div>

  <div class="chart-card">
    <div class="chart-title">ğŸ“¸ Ø§Ù„Ù„Ù‚Ø·Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</div>
    <div id="snapshotsList"></div>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø© (Ø±.Ø³)</th><th>Ø§Ù„Ù†Ø³Ø¨Ø© %</th>
        </tr>
      </thead>
      <tbody id="breakdownBody"></tbody>
    </table>
  </div>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  State
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let snapshots = [];
let chartNetworth = null, chartCategory = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Init
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  snapshots = Store.load('networth_snapshots', []);
  renderKPIs();
  renderCharts();
  renderSnapshots();
  renderBreakdown();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  KPIs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderKPIs() {
  const nw = calcNetWorth();

  const kpis = [
    { label:'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',        value:H.fmt(nw.total, 0) + ' Ø±.Ø³',           icon:'ğŸ’' },
    { label:'Ø§Ù„Ø£Ø³Ù‡Ù…',          value:H.fmt(nw.stocksValue, 0) + ' Ø±.Ø³',     icon:'ğŸ’¹' },
    { label:'Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª',        value:H.fmt(nw.propertiesValue, 0) + ' Ø±.Ø³', icon:'ğŸ ' },
    { label:'Ø§Ù„Ø°Ù‡Ø¨',           value:H.fmt(nw.goldValue, 0) + ' Ø±.Ø³',       icon:'ğŸ¥‡' },
    { label:'Ø§Ù„Ø³ÙŠÙˆÙ„Ø© ÙˆØ§Ù„Ù…Ø¯Ø®Ø±Ø§Øª', value:H.fmt(nw.cashValue + nw.savingsValue, 0) + ' Ø±.Ø³', icon:'ğŸ’µ' }
  ];

  document.getElementById('networthKPIs').innerHTML = kpis.map(k => `
    <div class="kpi-card">
      <div class="kpi-icon">${k.icon}</div>
      <div class="kpi-value">${k.value}</div>
      <div class="kpi-label">${k.label}</div>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Charts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCharts() {
  const nw = calcNetWorth();

  // Networth Timeline
  if (snapshots.length > 0) {
    const sorted = [...snapshots].sort((a,b) => new Date(a.date) - new Date(b.date));
    
    const ctx1 = document.getElementById('networthChart').getContext('2d');
    if (chartNetworth) chartNetworth.destroy();
    chartNetworth = new Chart(ctx1, {
      type: 'line',
      data: {
        labels: sorted.map(s => s.date),
        datasets: [{
          label: 'ØµØ§ÙÙŠ Ø§Ù„Ø«Ø±ÙˆØ© (Ø±.Ø³)',
          data: sorted.map(s => s.total),
          borderColor: '#6366f1',
          backgroundColor: 'rgba(99,102,241,.1)',
          tension: 0.3,
          fill: true,
          pointRadius: 4,
          pointHoverRadius: 6
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: (ctx) => `${H.fmt(ctx.parsed.y, 0)} Ø±.Ø³`
            }
          }
        },
        scales: {
          y: { 
            beginAtZero: true,
            ticks: { color: 'var(--text3)' },
            grid: { color: 'var(--border)' }
          },
          x: { 
            ticks: { color: 'var(--text3)' },
            grid: { display: false }
          }
        }
      }
    });
  } else {
    document.querySelector('#networthChart').parentElement.innerHTML = 
      '<p style="text-align:center;color:var(--text3);padding:60px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù„Ù‚Ø·Ø§Øª. Ø§Ù„ØªÙ‚Ø· Ù„Ù‚Ø·Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØªØ¨Ø¹.</p>';
  }

  // Category Breakdown
  const data = [
    { label: 'Ø§Ù„Ø£Ø³Ù‡Ù…', value: nw.stocksValue },
    { label: 'Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª', value: nw.propertiesValue },
    { label: 'Ø§Ù„Ø°Ù‡Ø¨', value: nw.goldValue },
    { label: 'Ø§Ù„Ø³ÙŠÙˆÙ„Ø©', value: nw.cashValue },
    { label: 'Ø§Ù„Ù…Ø¯Ø®Ø±Ø§Øª', value: nw.savingsValue }
  ].filter(d => d.value > 0);

  if (data.length > 0) {
    const ctx2 = document.getElementById('categoryChart').getContext('2d');
    if (chartCategory) chartCategory.destroy();
    chartCategory = new Chart(ctx2, {
      type: 'doughnut',
      data: {
        labels: data.map(d => d.label),
        datasets: [{
          data: data.map(d => d.value),
          backgroundColor: ['#6366f1','#8b5cf6','#ec4899','#f59e0b','#10b981'],
          borderWidth: 2,
          borderColor: 'var(--card)'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { 
            position: 'right', 
            labels: { color: 'var(--text)', font: { size: 12 } } 
          },
          tooltip: {
            callbacks: {
              label: (ctx) => `${ctx.label}: ${H.fmt(ctx.parsed, 0)} Ø±.Ø³`
            }
          }
        }
      }
    });
  } else {
    document.querySelector('#categoryChart').parentElement.innerHTML = 
      '<p style="text-align:center;color:var(--text3);padding:60px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Breakdown Table
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderBreakdown() {
  const nw = calcNetWorth();
  const total = nw.total;

  const rows = [
    { label: 'ğŸ’¹ Ø§Ù„Ø£Ø³Ù‡Ù…', value: nw.stocksValue },
    { label: 'ğŸ  Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª', value: nw.propertiesValue },
    { label: 'ğŸ¥‡ Ø§Ù„Ø°Ù‡Ø¨', value: nw.goldValue },
    { label: 'ğŸ’µ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©', value: nw.cashValue },
    { label: 'ğŸ· Ø§Ù„Ù…Ø¯Ø®Ø±Ø§Øª', value: nw.savingsValue }
  ];

  const tbody = document.getElementById('breakdownBody');
  tbody.innerHTML = rows.map(r => {
    const pct = total > 0 ? (r.value / total * 100) : 0;
    return `
      <tr>
        <td><strong>${r.label}</strong></td>
        <td>${H.fmt(r.value, 0)}</td>
        <td>${pct.toFixed(2)}%</td>
      </tr>
    `;
  }).join('');

  tbody.innerHTML += `
    <tr style="font-weight:700;background:var(--bg2)">
      <td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
      <td>${H.fmt(total, 0)}</td>
      <td>100%</td>
    </tr>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Snapshots
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSnapshots() {
  const list = document.getElementById('snapshotsList');
  
  if (!snapshots.length) {
    list.innerHTML = '<p style="text-align:center;color:var(--text3);padding:40px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù„Ù‚Ø·Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</p>';
    return;
  }

  const sorted = [...snapshots].sort((a,b) => new Date(b.date) - new Date(a.date));

  list.innerHTML = sorted.map(s => `
    <div class="snapshot-item">
      <div>
        <div class="date">${s.date}</div>
        <div style="font-size:11px;color:var(--text3);margin-top:2px">${s.note || 'Ù„Ù‚Ø·Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©'}</div>
      </div>
      <div style="display:flex;align-items:center;gap:16px">
        <div class="value">${H.fmt(s.total, 0)} Ø±.Ø³</div>
        <div class="delete" onclick="deleteSnapshot('${s.date}')" title="Ø­Ø°Ù">ğŸ—‘ï¸</div>
      </div>
    </div>
  `).join('');
}

function takeSnapshot() {
  const nw = calcNetWorth();
  const date = H.today();
  const note = prompt('Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):');

  const existing = snapshots.findIndex(s => s.date === date);
  if (existing !== -1) {
    if (!confirm('âš ï¸ ÙŠÙˆØ¬Ø¯ Ù„Ù‚Ø·Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®. Ø§Ø³ØªØ¨Ø¯Ø§Ù„ØŸ')) return;
    snapshots.splice(existing, 1);
  }

  snapshots.push({
    date,
    total: nw.total,
    stocks: nw.stocksValue,
    properties: nw.propertiesValue,
    gold: nw.goldValue,
    cash: nw.cashValue,
    savings: nw.savingsValue,
    note: note || ''
  });

  Store.save('networth_snapshots', snapshots);
  init();
  toast('âœ… ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ù„Ù‚Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

function deleteSnapshot(date) {
  if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù„Ù‚Ø·Ø©ØŸ')) return;
  
  snapshots = snapshots.filter(s => s.date !== date);
  Store.save('networth_snapshots', snapshots);
  init();
  toast('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Sync
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
dataSync.onDataChanged('portfolio', init);
dataSync.onDataChanged('properties', init);
dataSync.onDataChanged('gold', init);
dataSync.onDataChanged('cash', init);
dataSync.onDataChanged('savings', init);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Run
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
init();
</script>

</body>
</html>
