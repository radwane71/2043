<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<link rel="icon" href="data:,">
<title>Ø§Ù„Ù…Ø¯Ø®Ø±Ø§Øª â€” 2043</title>
<link rel="stylesheet" href="assets/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="assets/tickers.js"></script>
<script src="assets/data.js"></script>
<script src="assets/auth.js"></script>
<script src="assets/data-sync.js"></script>
<style>
.chart-wrap { position:relative; width:100%; height:280px; }
.chart-wrap canvas { width:100% !important; height:100% !important; }
.savings-card {
  background:var(--card); border:1px solid var(--border);
  border-radius:var(--radius); padding:20px; margin-bottom:16px;
  display:flex; justify-content:space-between; align-items:center;
}
.savings-card .left { display:flex; flex-direction:column; gap:4px; }
.savings-card .name { font-size:16px; font-weight:700; }
.savings-card .info { font-size:12px; color:var(--text3); }
.savings-card .right { display:flex; gap:12px; align-items:center; }
.savings-card .amount { font-size:22px; font-weight:800; color:var(--accent); }
.savings-card .actions { display:flex; gap:6px; }
</style>
</head>
<body>
<script>initPage('savings');</script>

<div class="main">

  <div class="page-header">
    <div class="page-header-left">
      <h1>ğŸ· Ø§Ù„Ù…Ø¯Ø®Ø±Ø§Øª</h1>
      <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø®Ø±Ø§Øª ÙˆØ§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
    </div>
    <div class="page-header-right">
      <button class="btn btn-primary btn-sm" onclick="saveAll()">ğŸ’¾ Ø­ÙØ¸</button>
    </div>
  </div>

  <div class="kpi-grid cols-3" id="savingsKPIs"></div>

  <div class="form-card">
    <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø®Ø± Ø¬Ø¯ÙŠØ¯</h3>
    <div class="form-row">
      <div class="form-group">
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø®Ø±</label>
        <input id="s-name" placeholder="ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦">
      </div>
      <div class="form-group">
        <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø±.Ø³)</label>
        <input id="s-amount" type="number" step="100" placeholder="25000">
      </div>
      <div class="form-group">
        <label>Ø§Ù„Ù‡Ø¯Ù (Ø±.Ø³)</label>
        <input id="s-goal" type="number" step="100" placeholder="50000">
      </div>
      <div class="form-group">
        <label>Ø§Ù„Ù†ÙˆØ¹</label>
        <select id="s-type">
          <option value="ØµÙ†Ø¯ÙˆÙ‚ Ø·ÙˆØ§Ø±Ø¦">ØµÙ†Ø¯ÙˆÙ‚ Ø·ÙˆØ§Ø±Ø¦</option>
          <option value="Ù‡Ø¯Ù Ø´Ø®ØµÙŠ">Ù‡Ø¯Ù Ø´Ø®ØµÙŠ</option>
          <option value="Ø§Ø¯Ø®Ø§Ø± Ø¹Ø§Ù…">Ø§Ø¯Ø®Ø§Ø± Ø¹Ø§Ù…</option>
          <option value="ØªÙ‚Ø§Ø¹Ø¯">ØªÙ‚Ø§Ø¹Ø¯</option>
          <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
      <textarea id="s-notes" rows="2" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©"></textarea>
    </div>
    <button class="btn btn-primary" onclick="addSaving()">â• Ø¥Ø¶Ø§ÙØ©</button>
  </div>

  <div class="chart-card">
    <div class="chart-title">ğŸ“Š Ø§Ù„ØªÙ‚Ø¯Ù… Ù†Ø­Ùˆ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</div>
    <div class="chart-wrap"><canvas id="progressChart"></canvas></div>
  </div>

  <div class="chart-card">
    <div class="chart-title">ğŸ’° Ø§Ù„Ù…Ø¯Ø®Ø±Ø§Øª</div>
    <div id="savingsList"></div>
  </div>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  State
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let savings = [];
let chartProgress = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Init
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  savings = APP.savings;
  renderKPIs();
  renderList();
  renderChart();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  KPIs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderKPIs() {
  const total = savings.reduce((s, sv) => s + (parseFloat(sv.amount) || 0), 0);
  const totalGoal = savings.reduce((s, sv) => s + (parseFloat(sv.goal) || 0), 0);
  const progress = totalGoal > 0 ? (total / totalGoal * 100) : 0;

  const kpis = [
    { label:'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯Ø®Ø±',    value:H.fmt(total, 0) + ' Ø±.Ø³',     icon:'ğŸ’°' },
    { label:'Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',     value:H.fmt(totalGoal, 0) + ' Ø±.Ø³', icon:'ğŸ¯' },
    { label:'Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²',       value:progress.toFixed(1) + '%',     icon:'ğŸ“Š' }
  ];

  document.getElementById('savingsKPIs').innerHTML = kpis.map(k => `
    <div class="kpi-card">
      <div class="kpi-icon">${k.icon}</div>
      <div class="kpi-value">${k.value}</div>
      <div class="kpi-label">${k.label}</div>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Add Saving
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addSaving() {
  const name = document.getElementById('s-name').value.trim();
  const amount = parseFloat(document.getElementById('s-amount').value) || 0;
  const goal = parseFloat(document.getElementById('s-goal').value) || 0;
  const type = document.getElementById('s-type').value;
  const notes = document.getElementById('s-notes').value.trim();

  if (!name) {
    toast('âš ï¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø®Ø± Ù…Ø·Ù„ÙˆØ¨', 'warn');
    return;
  }

  const newSaving = {
    id: Date.now(),
    name,
    amount,
    goal,
    type,
    notes
  };

  savings.push(newSaving);

  // Clear
  document.getElementById('s-name').value = '';
  document.getElementById('s-amount').value = '';
  document.getElementById('s-goal').value = '';
  document.getElementById('s-notes').value = '';

  saveAll();
  init();
  toast('âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  List
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderList() {
  const list = document.getElementById('savingsList');

  if (!savings.length) {
    list.innerHTML = '<p style="text-align:center;color:var(--text3);padding:40px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯Ø®Ø±Ø§Øª</p>';
    return;
  }

  list.innerHTML = savings.map(s => {
    const progress = s.goal > 0 ? (s.amount / s.goal * 100) : 0;
    const progressClamped = Math.min(progress, 100);

    return `
      <div class="savings-card">
        <div class="left">
          <div class="name">${s.name}</div>
          <div class="info">${s.type}</div>
          <div style="width:200px;height:8px;background:var(--bg2);border-radius:4px;margin-top:6px;overflow:hidden">
            <div style="width:${progressClamped}%;height:100%;background:var(--accent);transition:width .3s"></div>
          </div>
          <div class="info">${H.fmt(s.amount, 0)} Ù…Ù† ${H.fmt(s.goal, 0)} Ø±.Ø³ (${progress.toFixed(1)}%)</div>
        </div>
        <div class="right">
          <div class="amount">${H.fmt(s.amount, 0)} Ø±.Ø³</div>
          <div class="actions">
            <button class="btn btn-ghost btn-xs" onclick="updateAmount(${s.id})">ğŸ’µ</button>
            <button class="btn btn-danger btn-xs" onclick="deleteSaving(${s.id})">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Update Amount
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateAmount(id) {
  const s = savings.find(sv => sv.id === id);
  if (!s) return;

  const newAmount = prompt(`ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨Ù„Øº Ù„Ù€ "${s.name}":`, s.amount);
  if (newAmount === null || isNaN(newAmount)) return;

  s.amount = parseFloat(newAmount);

  saveAll();
  init();
  toast('âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Delete Saving
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function deleteSaving(id) {
  if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¯Ø®Ø±ØŸ')) return;

  savings = savings.filter(s => s.id !== id);

  saveAll();
  init();
  toast('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Chart
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderChart() {
  if (!savings.length) {
    document.querySelector('#progressChart').parentElement.innerHTML = '<p style="text-align:center;color:var(--text3);padding:60px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
    return;
  }

  const data = savings.map(s => ({
    name: s.name,
    progress: s.goal > 0 ? Math.min((s.amount / s.goal * 100), 100) : 0
  }));

  const ctx = document.getElementById('progressChart').getContext('2d');
  if (chartProgress) chartProgress.destroy();
  chartProgress = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: data.map(d => d.name),
      datasets: [{
        label: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² %',
        data: data.map(d => d.progress),
        backgroundColor: '#6366f1',
        borderRadius: 6
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        x: { beginAtZero: true, max: 100, ticks: { color: 'var(--text3)' }, grid: { color: 'var(--border)' } },
        y: { ticks: { color: 'var(--text3)' }, grid: { display: false } }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Save
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveAll() {
  Store.save('savings_v1', savings);
  toast('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­', 'success');
  dataSync.emit('savings');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Sync
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
dataSync.onDataChanged('savings', init);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Run
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
init();
</script>

</body>
</html>
